{
  "hash": "fd4be139b2417ab2cf9f93d334f9d94b",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat: \n  html:\n    theme: lux\n    number-sections: true\n\ntitle: \"Take-home Exercise 2\"\nauthor: \"Tai Yu Ying\"\ndate: \"Sep 25 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  message: false\n  freeze: true\n  warning: false\n---\n\n\n\n\n## Overview\n\nTourism is a critical part of Thailand’s economy, contributing around 20% of its GDP before the COVID-19 pandemic. In 2019, the country earned \\$90 billion from tourism, but this dropped sharply to \\$24 billion in 2020 due to the pandemic. Though recovery began in late 2021, revenues remain below pre-pandemic levels, with key tourist hubs like Bangkok and Phuket rebounding faster than smaller provinces.\n\nThis study focuses on understanding the spatial and temporal recovery of Thailand's tourism economy from 2019 to 2023. Using spatial autocorrelation methods such as Global Moran’s I and Local Moran’s I, we aim to detect clusters of tourism activity across provinces. In addition, we will conduct an emerging hotspot analysis to track tourism trends over time, revealing which areas are leading recovery and which remain underperforming.\n\nPrevious studies, such as Stankov et al. (2017), have successfully used spatial analysis to identify tourism clusters in Serbia, and Khan et al. (2017) applied similar methods in the U.S. to detect social trends. Applying these techniques in Thailand can provide insights into the geographic distribution of recovery, guiding targeted policy interventions.\n\n## Objective\n\nGiven the importance of the tourism sector to Thailand's economic recovery, this study aims to address the following key research questions:\n\n-   Are Thailand’s tourism revenue patterns spatially and temporally dependent?\n-   Where are the emerging hotspots and cold spots in tourism recovery?\n\n## Installing and launching the R packages\n\nIn this exercise, the following R packages will be used, they are:\n\n-   **`sf`**: For handling and manipulating **spatial data** (e.g., shapefiles of Thailand's provinces).\n-   **`sfdep`**: Provides tools for spatial dependence analysis on `sf` objects. This will be used for calculating spatial autocorrelation metrics like **Local Moran's I** and detecting clusters/outliers in tourism revenue data.\n-   **`spdep`**: For advanced spatial analysis, including **spatial weights** creation and conducting **spatial lag and error models** relevant to tourism data.\n-   **`tmap`**: Enables the creation of interactive and static **thematic maps**, crucial for visualizing clusters, hot/cold spots, and emerging tourism patterns.\n-   **`tidyverse`**: A suite of packages for data cleaning, manipulation, and visualization, used to manage and prepare the tourism data for analysis.\n-   **`knitr`**: Facilitates the generation of dynamic reports, integrating R code and output for documentation and reproducibility of the analysis.\n-   **`dplyr`**: Used for efficient data manipulation and cleaning, helping to preprocess the **tourism revenue dataset** before spatial analysis.\n-   **`spacetime`**: For managing and analyzing spatio-temporal data, allowing us to compare tourism revenue patterns over time (e.g., comparing 2020 and 2022 data).\n-   **`ggplot2`**: A visualization tool for creating detailed **spatial and statistical plots**, used to complement `tmap` for presenting tourism revenue patterns.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, sfdep, spdep, tmap, tidyverse, knitr, dplyr, spacetime, ggplot2)\n```\n:::\n\n\n\n\n## Data Import and Preparation\n\n### The Data\n\n-   [Thailand Domestic Tourism Statistics](https://www.kaggle.com/datasets/thaweewatboy/thailand-domestic-tourism-statistics) at Kaggle.\n\n-   [Thailand - Subnational Administrative Boundaries](https://data.humdata.org/dataset/cod-ab-tha?) on HDX.\n\n### Import [Thailand Domestic Tourism Statistics](https://www.kaggle.com/datasets/thaweewatboy/thailand-domestic-tourism-statistics)\n\nThis dataset provides monthly data on tourism activity across Thailand's provinces, from January 2019 to February 2023. The variable of interest is the ratio of tourist stays in each province, which reflects the percentage of tourists who stay overnight compared to the total number of visitors.\n\nSince data set is in csv file format, we will use [*read_csv()*](https://readr.tidyverse.org/reference/read_delim.html) of **readr** package to import `thailand_domestic_tourism_2019_2023_ver2.csv` as shown the code chunk below. The output R object is called `tour`.\n\n::: panel-tabset\n### The code\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntour <- read_csv(\"Data/rawdata/thailand_domestic_tourism_2019_2023_ver2.csv\")\n```\n:::\n\n\n\n\n### Examine output\n\nAfter importing the data file into R, it is important for us to examine if the data file has been imported correctly.\n\nThe code chunk below shows *summary()* and *list()* of Base R.\n\nThe dataset includes the following columns:\n\n-   `date`: The time period (monthly data).\n\n-   `province_thai`: The name of the province in Thai.\n\n-   `province_eng`: The name of the province in English.\n\n-   `region_thai`: The region name in Thai.\n\n-   `region_eng`: The region name in English.\n\n-   `variable`: 8 types of data being recorded, such as the number of tourists or the occupancy rate.\n\n    -   `no_tourist_all` The total number of tourists who visited the province\n\n    -   `no_tourist_foreign` The number of foreign tourists who visited the province\n\n    -   `no_tourist_stay` The total number of occupied hotel rooms in the province\n\n    -   `no_tourist_thai` The number of Thai tourists who visited the province\n\n    -   `ratio_tourist_stay` The percentage of occupied travel accommodation in the province\n\n    -   `revenue_all` The revenue generated by the tourism industry in the province, in Thai Baht\n\n    -   `revenue_foreign` The revenue generated by foreign tourists in the province, in Thai Baht\n\n    -   `revenue_thai` The revenue generated by Thai tourists in the province, in Thai Baht\n\n-   `value`: The value of the measured variable.\n\nThis dataset provides crucial insights into the tourism trends for each province, enabling the identification of recovery patterns after the pandemic. By analyzing the changes in the ratio of tourist stays, we can gauge how tourism activities have fluctuated in response to external factors, such as COVID-19.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(tour)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      date            province_thai      province_eng       region_thai       \n Min.   :2019-01-01   Length:30800       Length:30800       Length:30800      \n 1st Qu.:2020-01-01   Class :character   Class :character   Class :character  \n Median :2021-01-16   Mode  :character   Mode  :character   Mode  :character  \n Mean   :2021-01-15                                                           \n 3rd Qu.:2022-02-01                                                           \n Max.   :2023-02-01                                                           \n  region_eng          variable             value           \n Length:30800       Length:30800       Min.   :-4.250e+03  \n Class :character   Class :character   1st Qu.: 1.740e+03  \n Mode  :character   Mode  :character   Median : 9.335e+04  \n                                       Mean   : 3.360e+08  \n                                       3rd Qu.: 1.817e+07  \n                                       Max.   : 1.103e+11  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlist(tour)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n# A tibble: 30,800 × 7\n   date       province_thai province_eng   region_thai region_eng variable value\n   <date>     <chr>         <chr>          <chr>       <chr>      <chr>    <dbl>\n 1 2019-01-01 กรุงเทพมหานคร  Bangkok        ภาคกลาง     central    ratio_t…  93.4\n 2 2019-01-01 ลพบุรี          Lopburi        ภาคกลาง     central    ratio_t…  61.3\n 3 2019-01-01 พระนครศรีอยุธยา Phra Nakhon S… ภาคกลาง     central    ratio_t…  73.4\n 4 2019-01-01 สระบุรี         Saraburi       ภาคกลาง     central    ratio_t…  67.3\n 5 2019-01-01 ชัยนาท         Chainat        ภาคกลาง     central    ratio_t…  79.3\n 6 2019-01-01 นครปฐม        Nakhon Pathom  ภาคกลาง     central    ratio_t…  71.7\n 7 2019-01-01 สิงห์บุรี         Sing Buri      ภาคกลาง     central    ratio_t…  64.6\n 8 2019-01-01 อ่างทอง        Ang Thong      ภาคกลาง     central    ratio_t…  71.2\n 9 2019-01-01 นนทบุรี         Nonthaburi     ภาคกลาง     central    ratio_t…  75.1\n10 2019-01-01 ปทุมธานี        Pathum Thani   ภาคกลาง     central    ratio_t…  60.8\n# ℹ 30,790 more rows\n```\n\n\n:::\n:::\n\n\n\n:::\n\n### Import [Thailand - Subnational Administrative Boundaries](https://data.humdata.org/dataset/cod-ab-tha?)\n\nThis dataset contains the geographic boundaries of Thailand’s provinces, represented as polygons. It is essential for spatial analysis and will be used to map and visualize the spatial distribution of tourism activities across Thailand.\n\nThe code chunk below uses *st_read()* function of **sf** package to import `tha_adm_rtsd_itos_20210121_SHP` shapefile into R as a polygon feature data frame. \n\n::: panel-tabset\n### The code\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadmin_boundaries_raw <- st_read(\"Data/rawdata/tha_admbnda_adm2_rtsd_20220121.shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `tha_admbnda_adm2_rtsd_20220121' from data source \n  `C:\\gniyuy\\ISSS626_GA\\Take-home_Ex\\Take-home_Ex02\\Data\\rawdata\\tha_admbnda_adm2_rtsd_20220121.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 928 features and 19 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n\n\n### Examine output\n\nThe boundary dataset is currently using the **EPSG:4326 (WGS 84)** coordinate reference system, which employs latitude and longitude in degrees. While suitable for global mapping, EPSG:4326 is not ideal for precise local analysis due to its use of degrees rather than meters.\n\nTo improve spatial accuracy and facilitate local analysis in Thailand, the coordinate system will be transformed to **EPSG:32647** (UTM Zone 47N), which uses meters for measurement. The reasons include:\n\n1.  **Improved Accuracy**: UTM projections, like EPSG:32647, provide more precise distance and area calculations compared to WGS 84, which uses degrees.\n\n2.  **Better for Local Analysis**: UTM zones minimize distortions for regional-scale mapping, making it more suitable for spatial analysis in Thailand.\n\n3.  **Consistency**: Many spatial studies in Thailand use UTM Zone 47N for local accuracy.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(\"Geospatial Properties:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Geospatial Properties:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(st_crs(admin_boundaries_raw))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"latitude\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"longitude\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(st_geometry_type(admin_boundaries_raw))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  [1] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n  [6] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [11] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [16] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [21] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [26] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [31] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [36] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [41] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [46] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [51] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [56] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [61] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [66] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [71] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [76] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [81] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [86] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [91] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n [96] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[101] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[106] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[111] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[116] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[121] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[126] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[131] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[136] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[141] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[146] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[151] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[156] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[161] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[166] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[171] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[176] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[181] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[186] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[191] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[196] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[201] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[206] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[211] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[216] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[221] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[226] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[231] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[236] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[241] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[246] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[251] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[256] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[261] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[266] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[271] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[276] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[281] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[286] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[291] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[296] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[301] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[306] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[311] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[316] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[321] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[326] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[331] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[336] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[341] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[346] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[351] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[356] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[361] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[366] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[371] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[376] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[381] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[386] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[391] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[396] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[401] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[406] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[411] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[416] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[421] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[426] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[431] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[436] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[441] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[446] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[451] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[456] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[461] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[466] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[471] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[476] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[481] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[486] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[491] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[496] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[501] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[506] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[511] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[516] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[521] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[526] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[531] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[536] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[541] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[546] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[551] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[556] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[561] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[566] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[571] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[576] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[581] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[586] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[591] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[596] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[601] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[606] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[611] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[616] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[621] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[626] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[631] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[636] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[641] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[646] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[651] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[656] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[661] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[666] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[671] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[676] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[681] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[686] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[691] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[696] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[701] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[706] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[711] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[716] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[721] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[726] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[731] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[736] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[741] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[746] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[751] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[756] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[761] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[766] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[771] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[776] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[781] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[786] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[791] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[796] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[801] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[806] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[811] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[816] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[821] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[826] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[831] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[836] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[841] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[846] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[851] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[856] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[861] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[866] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[871] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[876] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[881] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[886] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[891] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[896] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[901] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[906] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[911] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[916] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[921] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n[926] MULTIPOLYGON MULTIPOLYGON MULTIPOLYGON\n18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(st_bbox(admin_boundaries_raw))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      xmin       ymin       xmax       ymax \n 97.343358   5.613038 105.636965  20.465074 \n```\n\n\n:::\n:::\n\n\n\n:::\n\n### Data Cleaning and Transformation for [Thailand Domestic Tourism Statistics](https://www.kaggle.com/datasets/thaweewatboy/thailand-domestic-tourism-statistics)\n\n::: panel-tabset\n### Selection of relevant columns\n\nThe most relevant columns are:\n\n-   `date`: Required for temporal analysis (spacetime analysis).\n-   `province_eng`: The English name of the province, which will be used to join with the spatial boundary dataset.\n-   `value`: The numerical value of the ratio of tourist stays, which is the key variable for your spatial analysis.\n-   `variable`: The variable measured (in this case, it appears to be \"ratio_tourist_stay,\" representing the ratio of tourist stays).\n\nThe other columns, such as `province_thai`, `region_thai`, and `region_eng`, can be omitted if they are not needed for your analysis.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select relevant columns: date, province_eng, and value\ntour_clean <- tour %>%\n                      select(date, province_eng, variable, value)\n\n# View the cleaned dataset\nhead(tour_clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  date       province_eng             variable           value\n  <date>     <chr>                    <chr>              <dbl>\n1 2019-01-01 Bangkok                  ratio_tourist_stay  93.4\n2 2019-01-01 Lopburi                  ratio_tourist_stay  61.3\n3 2019-01-01 Phra Nakhon Si Ayutthaya ratio_tourist_stay  73.4\n4 2019-01-01 Saraburi                 ratio_tourist_stay  67.3\n5 2019-01-01 Chainat                  ratio_tourist_stay  79.3\n6 2019-01-01 Nakhon Pathom            ratio_tourist_stay  71.7\n```\n\n\n:::\n:::\n\n\n\n\n### Handling Missing Data\n\nPrepare a tourism economy indicators layer using **sf** and **tidyverse** functions. The layer should contain tourism economy indicators (like the ratio of tourist stays) for each province.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Handle missing values\ntour_clean$value <- zoo::na.approx(tour_clean$value)\n```\n:::\n\n\n\n\n### Date and Time Aggregation\n\nKeep the time series at **month and year levels** to prepare for spacetime analysis.\n\nEnsure that the **date** column is correctly formatted and aggregate the data by month and year for each province. This step is crucial for later **spacetime S3 class** analysis.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert 'date' column to date type and aggregate by month and year\ntour_clean$date <- as.Date(tour_clean$date)\n\nmonthly_data <- tour_clean %>%\n                group_by(province_eng,variable, month = format(date, \"%Y-%m\")) %>%\n                summarize(total_value = mean(value, na.rm = TRUE))\n```\n:::\n\n\n\n\n### Rename `province_eng` to `ADM1_EN`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Rename the column\nmonthly_data <- monthly_data %>%\n  dplyr:::rename.data.frame(ADM1_EN = province_eng)\n```\n:::\n\n\n\n\n### Rename provinces to match both dataset\n\n| Under `Thailand Domestic Tourism Statistics` | Under `Thailand - Subnational Administrative Boundaries` |\n|------------------------------------|------------------------------------|\n| Buriram | Buri Ram |\n| Chainat | Chai Nat |\n| Chonburi | Chon Buri |\n| Lopburi | Lop Buri |\n| Nong Bua Lamphu | Nong Bua Lam Phu |\n| Phang Nga | Phangnga |\n| Prachinburi | Prachin Buri |\n| Sisaket | Si Sa Ket |\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a named vector for renaming provinces\nrename_provinces <- c(\n  \"Buriram\" = \"Buri Ram\",\n  \"Chainat\" = \"Chai Nat\",\n  \"Chonburi\" = \"Chon Buri\",\n  \"Lopburi\" = \"Lop Buri\",\n  \"Nong Bua Lamphu\" = \"Nong Bua Lam Phu\",\n  \"Phang Nga\" = \"Phangnga\",\n  \"Prachinburi\" = \"Prachin Buri\",\n  \"Sisaket\" = \"Si Sa Ket\"\n)\n\n# Rename provinces in the 'ADM1_EN' column using dplyr\nmonthly_data <- monthly_data %>%\n  mutate(ADM1_EN = recode(ADM1_EN, !!!rename_provinces))\n```\n:::\n\n\n\n\n### Split of dataset into each variable\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter the data for 'no_tourist_all'\nno_tourist_all_data <- monthly_data %>%\n                    filter(variable == \"no_tourist_all\")\nwrite_rds(no_tourist_all_data, \"Data/rds/no_tourist_all_data.rds\")\nno_tourist_all_data_join <- readRDS(\"Data/rds/no_tourist_all_data.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter the data for 'revenue_all'\nrevenue_all_data <- monthly_data %>%\n                    filter(variable == \"revenue_all\")\nwrite_rds(revenue_all_data, \"Data/rds/revenue_all_data.rds\")\nrevenue_all_data_join <- readRDS(\"Data/rds/revenue_all_data.rds\")\n```\n:::\n\n\n\n:::\n\n### Exploratory Data Analysis (EDA) for [Thailand Domestic Tourism Statistics](https://www.kaggle.com/datasets/thaweewatboy/thailand-domestic-tourism-statistics)\n\nTo derive a **tourism economy indicator layer** to be used for global and local spatial autocorrelation analysis.\n\nWe can conduct preliminary visualizations (e.g., time series plots or heat maps) to understand tourism trends and identify any anomalies. This step helps ensure the data is ready for more complex spatial analysis.\n\n::: panel-tabset\n### Summary\n\n-   **Tourist Distribution**:\n\n    -   **Total Tourists (no_tourist_all)**: The average number of tourists is around 206,000, but some provinces see as many as 6.13 million, while others experience months with no tourists.\n\n    -   **Foreign Tourists (no_tourist_foreign)**: On average, provinces attract 32,000 foreign tourists, but the median is much lower at 553, showing that a few provinces (up to 2.47 million tourists) dominate international tourism.\n\n    -   **Domestic Tourists (no_tourist_thai)**: Domestic tourism is significant, with an average of 174,000 tourists per province, reaching a maximum of 4.08 million.\n\n-   **Overnight Stays**:\n\n    -   **Overnight Tourists (no_tourist_stay)**: The average number of tourists staying overnight is 105,000, but this varies widely across provinces.\n\n    -   **Ratio of Overnight Stays (ratio_tourist_stay)**: On average, 40% of tourists stay overnight, but this can range from 0% (day-trippers) to nearly 96%.\n\n-   **Tourism Revenue**:\n\n    -   **Total Revenue (revenue_all)**: Provinces earn an average of 1.34 billion Baht in tourism revenue, with the highest revenue reaching over 1 trillion Baht, indicating a large revenue disparity.\n\n    -   **Foreign Revenue (revenue_foreign)**: Foreign tourists contribute an average of 680 million Baht, with some provinces earning as much as 85 billion Baht.\n\n    -   **Domestic Revenue (revenue_thai)**: Domestic tourists generate an average of 663 million Baht, with a maximum of 45 billion Baht in some provinces.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Group by variable and calculate summary statistics for each category\nsummary_stats <- monthly_data %>%\n                 group_by(variable) %>%\n                 summarize(mean_value = mean(total_value, na.rm = TRUE),\n                           median_value = median(total_value, na.rm = TRUE),\n                           min_value = min(total_value, na.rm = TRUE),\n                           max_value = max(total_value, na.rm = TRUE))\n\nprint(summary_stats)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 5\n  variable             mean_value median_value min_value max_value\n  <chr>                     <dbl>        <dbl>     <dbl>     <dbl>\n1 no_tourist_all         206328.       92122.          0   6.13e 6\n2 no_tourist_foreign      32366.         553           0   2.47e 6\n3 no_tourist_stay        105161.       44579           0   3.34e 6\n4 no_tourist_thai        173962.       88782           0   4.09e 6\n5 ratio_tourist_stay         38.9         41.8         0   9.59e 1\n6 revenue_all        1343875802.   195495000           0   1.10e11\n7 revenue_foreign     680232189.     1540000       -4250   8.50e10\n8 revenue_thai        663643613.   177310000           0   4.51e10\n```\n\n\n:::\n:::\n\n\n\n\n### Trends Over Time by Category\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(no_tourist_all_data, aes(x = month, y = total_value)) +\n  geom_bar(stat = \"identity\", fill = \"steelblue\") +\n  labs(title = \"Monthly Total Number of All Tourists, 2019-2023\",\n       x = \"Month-Year\", y = \"No. of Tourists\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(revenue_all_data, aes(x = month, y = total_value)) +\n  geom_bar(stat = \"identity\", fill = \"steelblue\") +\n  labs(title = \"Monthly Total Revenue from Tourism Industry, 2019-2023\",\n       x = \"Month-Year\", y = \"Total Revenue\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n\n### Total Revenue by Province in 2019\n\nFigure below reveals that the tourism economy of Thailand are mainly focus on five provinces, namely Bangkok, Phuket, Chonburi, Krabi and Chiang Mai.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter the data for all months in 2019 and \"revenue_all\" in the 'variable' column\nrevenue_2019 <- monthly_data %>%\n  filter(variable == \"revenue_all\", grepl(\"^2019-\", month)) %>%\n  group_by(ADM1_EN) %>%\n  summarize(total_revenue = sum(total_value, na.rm = TRUE))\n\n# Create a bar plot using ggplot2\nggplot(revenue_2019, aes(x = reorder(ADM1_EN, total_revenue), y = total_revenue)) +\n  geom_bar(stat = \"identity\", fill = \"skyblue\", color = \"black\") +\n  coord_flip() + # Flip coordinates to make a horizontal bar plot\n  labs(title = \"Total Revenue by Province in 2019\",\n       x = \"Province\",\n       y = \"Total Revenue\") +\n  theme_minimal() # Use a minimal theme for a clean look\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\n### Data Cleaning and Transformation for [Thailand - Subnational Administrative Boundaries](https://data.humdata.org/dataset/cod-ab-tha?)\n\n::: panel-tabset\n### Prepare study area layer in sf polygon\n\nThis will enable the linking of tourism data with geographic boundaries.\n\nEnsure that all provinces are included in the boundary dataset and that their polygon geometries are valid. Check for and fix any invalid geometries.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check and fix invalid geometries\nsum(!st_is_valid(admin_boundaries_raw))  # Check for invalid geometries\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n\n```{.r .cell-code}\nboundaries <- st_make_valid(admin_boundaries_raw)  # Fix invalid geometries\n```\n:::\n\n\n\n\n### Selecting relevant columns\n\nThe following columns that provide information on the administrative area can be retained, such as:\n\n-   `ADM1_EN` (English name of the first-level boundary, e.g., province)\n\n-   `geometry` (spatial information in MULTIPOLYGON format)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadmin_boundaries_filtered <- admin_boundaries_raw %>%\n  dplyr::select(ADM1_EN, geometry)\n```\n:::\n\n\n\n\n### Remove Z and M dimensions from the admin boundaries dataset\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadmin_boundaries_drop <- st_zm(admin_boundaries_filtered, drop = TRUE, what = \"ZM\")\n```\n:::\n\n\n\n\n### CRS Transformation\n\nTransform the CRS from **EPSG:4326 (WGS 84)** to **EPSG:32647 (UTM Zone 47N)** to align with local spatial analysis requirements.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadmin_boundaries_cleaned <- admin_boundaries_drop %>%\n  st_transform(crs = 32647) \n\n# Display the filtered data\nsummary(admin_boundaries_cleaned)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   ADM1_EN                   geometry  \n Length:928         MULTIPOLYGON :928  \n Class :character   epsg:32647   :  0  \n Mode  :character   +proj=utm ...:  0  \n```\n\n\n:::\n:::\n\n\n\n\n### Aggregate district-level geometries to province-level boundaries\n\nGroup the data by `ADM1_EN` (the province name) and ensure that you only keep one geometry per province.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimplified_provinces <- admin_boundaries_cleaned %>%\n  group_by(ADM1_EN) %>%\n  summarize(geometry = st_union(geometry)) %>%\n  st_cast(\"MULTIPOLYGON\")\n```\n:::\n\n\n\n:::\n\n### Merging the Two Datasets\n\nMerge the tourism dataset with the provincial boundary dataset to create the **study area layer** and **tourism economy indicators layer** for spatial analysis.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nno_tourist_all_join <- dplyr:::left_join.data.frame(simplified_provinces, no_tourist_all_data, by = c(ADM1_EN = \"ADM1_EN\"))\nwrite_rds(no_tourist_all_join, \"Data/rds/no_tourist_all.rds\")\nno_tourist_all_join <- readRDS(\"Data/rds/no_tourist_all.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrevenue_all_join <- dplyr:::left_join.data.frame(simplified_provinces, revenue_all_data, by = c(ADM1_EN = \"ADM1_EN\"))\nwrite_rds(revenue_all_join, \"Data/rds/rev_all.rds\")\nrevenue_all_join <- readRDS(\"Data/rds/rev_all.rds\")\n```\n:::\n\n\n\n\n### Filter the Data for Each Year\n\nTo investigate the impact of COVID-19 on Thailand's tourism industry while choosing specific years, would recommend focusing on the following years:\n\n-   **2020 (Pandemic Year)**: This year represents the height of the COVID-19 pandemic, with lockdowns, travel restrictions, and a significant decline in both international and domestic tourism. Analyzing this year will highlight how severely the pandemic disrupted tourism in Thailand.\n\n-   **2022 (Recovery Year)**: By 2022, many countries, including Thailand, began easing restrictions, allowing travel to resume. Analyzing this year helps to assess the recovery phase and whether the tourism industry has bounced back to pre-pandemic levels, or if it is still lagging.\n\nBy focusing on these two years, we can clearly assess the immediate impact of the pandemic and the subsequent recovery, providing a targeted understanding of how tourism dynamics shifted between the crisis and recovery periods.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert the 'month' column to a date format\nrevenue_all_join <- revenue_all_join %>%\n  mutate(month = as.Date(paste0(month, \"-01\"), format = \"%Y-%m-%d\"))\n\nno_tourist_all_join <- no_tourist_all_join %>%\n  mutate(month = as.Date(paste0(month, \"-01\"), format = \"%Y-%m-%d\"))\n```\n:::\n\n\n\n\n#### Total revenue generated by tourism industry\n\n::: panel-tabset\n#### Pandemic Year: 2020\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2020 <- revenue_all_join %>% filter(format(as.Date(month), \"%Y\") == \"2020\")\n\n# Summarize total revenue by province for 2020\nrev_2020 <- rev_2020 %>%\n  group_by(ADM1_EN) %>%\n  summarize(total_revenue = sum(total_value, na.rm = TRUE))\n```\n:::\n\n\n\n\n#### Recovery Year: 2022\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2022 <- revenue_all_join %>% filter(format(as.Date(month), \"%Y\") == \"2022\")\n\n# Summarize total revenue by province for 2020\nrev_2022 <- rev_2022 %>%\n  group_by(ADM1_EN) %>%\n  summarize(total_revenue = sum(total_value, na.rm = TRUE))\n```\n:::\n\n\n\n:::\n\n#### Number of tourists visited the provinces\n\n::: panel-tabset\n#### Pandemic Year: 2020\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnotour_2020 <- no_tourist_all_join %>% filter(format(as.Date(month), \"%Y\") == \"2020\")\n\n# Summarize total revenue by province for 2020\nnotour_2020 <- notour_2020 %>%\n  group_by(ADM1_EN) %>%\n  summarize(no_tourist = sum(total_value, na.rm = TRUE))\n```\n:::\n\n\n\n\n#### Recovery Year: 2022\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnotour_2022 <- no_tourist_all_join %>% filter(format(as.Date(month), \"%Y\") == \"2022\")\n\n# Summarize total revenue by province for 2020\nnotour_2022 <- notour_2022 %>%\n  group_by(ADM1_EN) %>%\n  summarize(no_tourist = sum(total_value, na.rm = TRUE))\n```\n:::\n\n\n\n:::\n\n### Saving the Analytical Data Table\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(rev_2020, \"Data/rds/rev_2020.rds\")\nwrite_rds(rev_2022, \"Data/rds/rev_2022.rds\")\nwrite_rds(notour_2020, \"Data/rds/notour_2020 .rds\")\nwrite_rds(notour_2022, \"Data/rds/notour_2022 .rds\")\n```\n:::\n\n\n\n\n## Visualising Thailand tourism economy\n\nLet’s load the .rds file using the *readRDS()* function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2020 <- readRDS(\"Data/rds/rev_2020.rds\")\nrev_2022 <- readRDS(\"Data/rds/rev_2022.rds\")\nnotour_2020 <- readRDS(\"Data/rds/notour_2020 .rds\")\nnotour_2022 <- readRDS(\"Data/rds/notour_2022 .rds\")\n```\n:::\n\n\n\n\nNow, we are going to prepare a basemap and a choropleth map showing the distribution of Thailand tourism economy by using *qtm()* of **tmap** package.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbasemap <- tm_shape(rev_2020) +\n  tm_polygons() +\n  tm_text(\"ADM1_EN\", size=0.5)\n\nrev_2020_map <- qtm(rev_2020, \"total_revenue\")\ntmap_arrange(basemap, rev_2020_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbasemap <- tm_shape(rev_2022) +\n  tm_polygons() +\n  tm_text(\"ADM1_EN\", size=0.5)\n\nrev_2022_map <- qtm(rev_2022, \"total_revenue\")\ntmap_arrange(basemap, rev_2022_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbasemap <- tm_shape(notour_2020) +\n  tm_polygons() +\n  tm_text(\"ADM1_EN\", size=0.5)\n\nnotour_2020_map <- qtm(notour_2020, \"no_tourist\")\ntmap_arrange(basemap, notour_2020_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbasemap <- tm_shape(notour_2022) +\n  tm_polygons() +\n  tm_text(\"ADM1_EN\", size=0.5)\n\nnotour_2022_map <- qtm(notour_2022, \"no_tourist\")\ntmap_arrange(basemap, notour_2022_map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\n\n\n## Global Spatial Autocorrelation Analysis\n\nGlobal Spatial Autocorrelation Analysis helps determine whether the spatial distribution of tourism revenue is random or exhibits patterns across different regions. This step involves applying the `sfdep` package in R to compute the Global Moran’s I statistic, which measures the degree of spatial autocorrelation in the dataset. The analysis includes significance testing to confirm whether any detected patterns are statistically significant.\n\nGlobal Moran’s I is a statistical measure that assesses whether the observed values (e.g., tourism revenue) are clustered, dispersed, or randomly distributed in space. A positive Moran’s I value suggests clustering, a negative value indicates dispersion, and a value near zero implies randomness.\n\n### Total revenue generated by tourism industry\n\n`revenue_all` represents the total revenue generated by the tourism industry in each province, which makes it a suitable choice for analyzing spatial patterns in economic impact.\n\nSince the analysis aims to understand the spatial distribution of the tourism economy, using revenue data provides direct insights into the financial performance of each province.\n\n#### Pandemic Year: 2020\n\n::: panel-tabset\n### Computing (QUEEN) contiguity based neighbours\n\nThe code chunk below is used to compute Queen contiguity weight matrix.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q_rev_2020 <- poly2nb(rev_2020, queen=TRUE)\nsummary(wm_q_rev_2020)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 352 \nPercentage nonzero weights: 5.93692 \nAverage number of links: 4.571429 \n1 region with no links:\n48\n2 disjoint connected subgraphs\nLink number distribution:\n\n 0  1  2  3  4  5  6  7  8  9 \n 1  1  5 17 15 17 10  5  4  2 \n1 least connected region:\n71 with 1 link\n2 most connected regions:\n17 69 with 9 links\n```\n\n\n:::\n:::\n\n\n\n\nThe summary report above shows that there are 77 area units in Thailand. The most connected area unit has 9 neighbours. There are one area units with only one neighbours.\n\n### Creating (ROOK) contiguity based neighbours\n\nThe code chunk below is used to compute Rook contiguity weight matrix.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_r_rev_2020 <- poly2nb(rev_2020, queen=FALSE)\nsummary(wm_r_rev_2020)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 352 \nPercentage nonzero weights: 5.93692 \nAverage number of links: 4.571429 \n1 region with no links:\n48\n2 disjoint connected subgraphs\nLink number distribution:\n\n 0  1  2  3  4  5  6  7  8  9 \n 1  1  5 17 15 17 10  5  4  2 \n1 least connected region:\n71 with 1 link\n2 most connected regions:\n17 69 with 9 links\n```\n\n\n:::\n:::\n\n\n\n\nThe summary report above shows that there are 77 area units in Thailand. The most connected area unit has 9 neighbours. There are one area units with only one neighbours.\n\n### Summary\n\nA summary of the results are below. In our case, both methods yield similar results.\n\n|                              | Queen Contiguity | Rook Contiguity |\n|------------------------------|------------------|-----------------|\n| No. of regions with no links | 5                | 5               |\n| Average number of links      | 4.571            | 4.571           |\n:::\n\n##### Create spatial weights matrix\n\nCreate a spatial weights matrix using the tourism data. The spatial weights define how each region is connected to other regions, based on criteria such as contiguity (neighboring areas) or distance.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrswm_q_rev_2020 <- nb2listw(wm_q_rev_2020, \n                   style=\"W\", \n                   zero.policy = TRUE)\nrswm_q_rev_2020\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCharacteristics of weights list object:\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 352 \nPercentage nonzero weights: 5.93692 \nAverage number of links: 4.571429 \n1 region with no links:\n48\n2 disjoint connected subgraphs\n\nWeights style: W \nWeights constants summary:\n   n   nn S0       S1      S2\nW 76 5776 76 36.26113 315.652\n```\n\n\n:::\n:::\n\n\n\n\n##### Calculate Global Moran’s I\n\n::: panel-tabset\n### Global Moran’s I\n\nThe code chunk below performs Moran’s I statistical testing using moran.test() of spdep.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoran.test(rev_2020$total_revenue, \n           listw=rswm_q_rev_2020, \n           zero.policy = TRUE, \n           na.action=na.omit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  rev_2020$total_revenue  \nweights: rswm_q_rev_2020  \nn reduced by no-neighbour observations  \n\nMoran I statistic standard deviate = -0.48052, p-value = 0.6846\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n     -0.036786950      -0.013333333       0.002382331 \n```\n\n\n:::\n:::\n\n\n\n\n### Interpretation\n\n-   **Value**: `-0.036786950`\n\n    -   This value is close to zero, which suggests there is **no significant spatial autocorrelation** in the tourism revenue data across provinces. In simpler terms, the tourism revenue in one province does not seem to be strongly correlated with the tourism revenue in neighboring provinces.\n\n    -   A Moran's I value close to zero implies that the distribution of tourism revenue across the provinces is random rather than clustered or dispersed.\n\n-   **p-value**:\n\n    -   **Value**: `0.6846`\n\n        -   The p-value is much higher than the standard significance level (typically 0.05 or 0.01), which means there is **no statistically significant spatial autocorrelation**. This indicates that you cannot reject the null hypothesis of no spatial correlation.\n\n        -   In other words, there is no statistically significant pattern of similarity or dissimilarity in tourism revenue among neighboring provinces.\n\nInterpretation of the Results in Context:\n\n-   **Conclusion**: The results suggest that tourism revenue in each province is not spatially dependent. Neighboring provinces do not tend to have similar tourism revenue patterns, and the distribution of tourism revenue is likely random across provinces.\n\n-   **Implications**: This finding implies that the factors influencing tourism revenue may be more locally specific or influenced by other non-spatial factors (such as marketing efforts, tourism infrastructure, or attractions within each province), rather than proximity to neighboring provinces.\n:::\n\n##### Computing Monte Carlo Moran’s I\n\n::: panel-tabset\n### Monte Carlo Moran’s I\n\nThe code chunk below performs permutation test for Moran’s I statistic by using [`moran.mc()`](https://r-spatial.github.io/spdep/reference/moran.mc.html) of **spdep**. A total of 1000 simulation will be performed.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nbperm_rev_2020= moran.mc(rev_2020$total_revenue, \n                listw=rswm_q_rev_2020, \n                nsim=999, \n                zero.policy = TRUE, \n                na.action=na.omit)\nbperm_rev_2020\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  rev_2020$total_revenue \nweights: rswm_q_rev_2020  \nnumber of simulations + 1: 1000 \n\nstatistic = -0.036787, observed rank = 345, p-value = 0.655\nalternative hypothesis: greater\n```\n\n\n:::\n:::\n\n\n\n\n### Interpretation\n\n-   **Value**: `-0.036787`\n\n    -   This value is very close to zero, indicating **no significant spatial autocorrelation** in the tourism revenue data across provinces. It suggests that tourism revenue in one province is not related to the tourism revenue in neighboring provinces.\n\n-   **p-value**:\n\n    -   **Value**: `0.655`\n\n        -   The p-value from the simulation is quite large, much greater than the standard threshold of 0.05, meaning that there is **no statistically significant spatial autocorrelation** in tourism revenue. You cannot reject the null hypothesis of no spatial autocorrelation.\n\n        -   The high p-value reinforces that the distribution of tourism revenue across provinces is likely random and not spatially dependent.\n\n-   **Observed rank**:\n\n    -   **Observed rank = 345** means that out of the 1000 simulations, the test statistic from your actual data ranked 345th in terms of magnitude. This suggests that your observed Moran's I value is not unusual compared to the distribution of randomly generated statistics, further indicating no significant spatial pattern.\n\n### Interpretation of the Results:\n\n-   **Conclusion**: Similar to the earlier Moran’s I test, this Monte Carlo simulation confirms that there is **no significant spatial autocorrelation** in tourism revenue across the provinces. The tourism revenue in one province does not influence or show a correlation with that of neighboring provinces.\n\n-   **Implications**: Tourism revenue is likely influenced by factors that are not spatially distributed (such as specific attractions, infrastructure, or marketing efforts in each province). The lack of spatial dependency implies that proximity to high-earning provinces doesn't necessarily mean a neighboring province will also have high tourism revenue.\n:::\n\n##### Visualize the Results\n\nSince the observed Moran's I (red line) lies within the range of the simulated values and near the center of the distribution, this indicates that **the spatial distribution of tourism revenue across provinces is random**. In other words, there is no significant spatial pattern where provinces with high or low tourism revenue cluster together.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(bperm_rev_2020$res, \n     freq=TRUE, \n     breaks=20, \n     xlab=\"Simulated Moran's I\")\nabline(v=0, \n       col=\"red\") \n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\n\n\n#### Recovering Year: 2022\n\n::: panel-tabset\n### Computing (QUEEN) contiguity based neighbours\n\nThe code chunk below is used to compute Queen contiguity weight matrix.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q_rev_2022 <- poly2nb(rev_2022, queen=TRUE)\nsummary(wm_q_rev_2022)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 352 \nPercentage nonzero weights: 5.93692 \nAverage number of links: 4.571429 \n1 region with no links:\n48\n2 disjoint connected subgraphs\nLink number distribution:\n\n 0  1  2  3  4  5  6  7  8  9 \n 1  1  5 17 15 17 10  5  4  2 \n1 least connected region:\n71 with 1 link\n2 most connected regions:\n17 69 with 9 links\n```\n\n\n:::\n:::\n\n\n\n\nThe summary report above shows that there are 77 area units in Thailand. The most connected area unit has 9 neighbours. There are one area units with only one neighbours.\n\n### Creating (ROOK) contiguity based neighbours\n\nThe code chunk below is used to compute Rook contiguity weight matrix.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q_rev_2022 <- poly2nb(rev_2022, queen=FALSE)\nsummary(wm_q_rev_2022)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 352 \nPercentage nonzero weights: 5.93692 \nAverage number of links: 4.571429 \n1 region with no links:\n48\n2 disjoint connected subgraphs\nLink number distribution:\n\n 0  1  2  3  4  5  6  7  8  9 \n 1  1  5 17 15 17 10  5  4  2 \n1 least connected region:\n71 with 1 link\n2 most connected regions:\n17 69 with 9 links\n```\n\n\n:::\n:::\n\n\n\n\nThe summary report above shows that there are 77 area units in Thailand. The most connected area unit has 9 neighbours. There are one area units with only one neighbours.\n\n### Summary\n\nA summary of the results are below. In our case, both methods yield similar results.\n\n|                              | Queen Contiguity | Rook Contiguity |\n|------------------------------|------------------|-----------------|\n| No. of regions with no links | 5                | 5               |\n| Average number of links      | 4.571            | 4.571           |\n:::\n\n##### Create spatial weights matrix\n\nCreate a spatial weights matrix using the tourism data. The spatial weights define how each region is connected to other regions, based on criteria such as contiguity (neighboring areas) or distance.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrswm_q_rev_2022 <- nb2listw(wm_q_rev_2022, \n                   style=\"W\", \n                   zero.policy = TRUE)\nrswm_q_rev_2022\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCharacteristics of weights list object:\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 352 \nPercentage nonzero weights: 5.93692 \nAverage number of links: 4.571429 \n1 region with no links:\n48\n2 disjoint connected subgraphs\n\nWeights style: W \nWeights constants summary:\n   n   nn S0       S1      S2\nW 76 5776 76 36.26113 315.652\n```\n\n\n:::\n:::\n\n\n\n\n##### Calculate Global Moran’s I\n\n::: panel-tabset\n### Global Moran’s I\n\nThe code chunk below performs Moran’s I statistical testing using moran.test() of spdep.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoran.test(rev_2022$total_revenue, \n           listw=rswm_q_rev_2022, \n           zero.policy = TRUE, \n           na.action=na.omit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMoran I test under randomisation\n\ndata:  rev_2022$total_revenue  \nweights: rswm_q_rev_2022  \nn reduced by no-neighbour observations  \n\nMoran I statistic standard deviate = -0.29739, p-value = 0.6169\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n     -0.029460999      -0.013333333       0.002940908 \n```\n\n\n:::\n:::\n\n\n\n\n### Interpretation\n\n-   **Value**: `-0.29739`\n\n    -   This value is close to zero, which suggests there is **no significant spatial autocorrelation** in the tourism revenue data across provinces. In simpler terms, the tourism revenue in one province does not seem to be strongly correlated with the tourism revenue in neighboring provinces.\n\n    -   A Moran's I value close to zero implies that the distribution of tourism revenue across the provinces is random rather than clustered or dispersed.\n\n-   **p-value**:\n\n    -   **Value**: `0.6169`\n\n        -   The p-value is much higher than the standard significance level (typically 0.05 or 0.01), which means there is **no statistically significant spatial autocorrelation**. This indicates that you cannot reject the null hypothesis of no spatial correlation.\n\n        -   In other words, there is no statistically significant pattern of similarity or dissimilarity in tourism revenue among neighboring provinces.\n\nInterpretation of the Results in Context:\n\n-   **Conclusion**: The results suggest that tourism revenue in each province is not spatially dependent. Neighboring provinces do not tend to have similar tourism revenue patterns, and the distribution of tourism revenue is likely random across provinces.\n\n-   **Implications**: This finding implies that the factors influencing tourism revenue may be more locally specific or influenced by other non-spatial factors (such as marketing efforts, tourism infrastructure, or attractions within each province), rather than proximity to neighboring provinces.\n:::\n\n##### Computing Monte Carlo Moran’s I\n\n::: panel-tabset\n### Monte Carlo Moran’s I\n\nThe code chunk below performs permutation test for Moran’s I statistic by using [`moran.mc()`](https://r-spatial.github.io/spdep/reference/moran.mc.html) of **spdep**. A total of 1000 simulation will be performed.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nbperm_rev_2022= moran.mc(rev_2022$total_revenue, \n                listw=rswm_q_rev_2022, \n                nsim=999, \n                zero.policy = TRUE, \n                na.action=na.omit)\nbperm_rev_2022\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  rev_2022$total_revenue \nweights: rswm_q_rev_2022  \nnumber of simulations + 1: 1000 \n\nstatistic = -0.029461, observed rank = 494, p-value = 0.506\nalternative hypothesis: greater\n```\n\n\n:::\n:::\n\n\n\n\n### Interpretation\n\n-   **Value**: `-0.029461`\n\n    -   This value is very close to zero, indicating **no significant spatial autocorrelation** in the tourism revenue data across provinces. It suggests that tourism revenue in one province is not related to the tourism revenue in neighboring provinces.\n\n-   **p-value**:\n\n    -   **Value**: `0.506`\n\n        -   The p-value from the simulation is quite large, much greater than the standard threshold of 0.05, meaning that there is **no statistically significant spatial autocorrelation** in tourism revenue. You cannot reject the null hypothesis of no spatial autocorrelation.\n\n        -   The high p-value reinforces that the distribution of tourism revenue across provinces is likely random and not spatially dependent.\n\n-   **Observed rank**:\n\n    -   **Observed rank = 345** means that out of the 1000 simulations, the test statistic from your actual data ranked 345th in terms of magnitude. This suggests that your observed Moran's I value is not unusual compared to the distribution of randomly generated statistics, further indicating no significant spatial pattern.\n\n### Interpretation of the Results:\n\n-   **Conclusion**: Similar to the earlier Moran’s I test, this Monte Carlo simulation confirms that there is **no significant spatial autocorrelation** in tourism revenue across the provinces. The tourism revenue in one province does not influence or show a correlation with that of neighboring provinces.\n\n-   **Implications**: Tourism revenue is likely influenced by factors that are not spatially distributed (such as specific attractions, infrastructure, or marketing efforts in each province). The lack of spatial dependency implies that proximity to high-earning provinces doesn't necessarily mean a neighboring province will also have high tourism revenue.\n:::\n\n##### Visualize the Results\n\nSince the observed Moran's I (red line) lies within the range of the simulated values and near the center of the distribution, this indicates that **the spatial distribution of tourism revenue across provinces is random**. In other words, there is no significant spatial pattern where provinces with high or low tourism revenue cluster together.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(bperm_rev_2022$res, \n     freq=TRUE, \n     breaks=20, \n     xlab=\"Simulated Moran's I\")\nabline(v=0, \n       col=\"red\") \n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\n\n\n\n## Local Spatial Autocorrelation Analysis\n\nTo perform **Local Spatial Autocorrelation Analysis**, we will focus on two variables from your dataset: `no_tourist_all` and `revenue_all`. These represent the total number of tourists and total revenue, respectively. For each, we'll apply **Local Moran's I** to identify hotspots, cold spots, and spatial outliers.\n\n### Total revenue generated by tourism industry\n\n#### Pandemic Year: 2020\n\n##### Local Moran's I Calculation\n\n::: panel-tabset\n### Local Moran's I\n\nTo compute local Moran’s I, the [*localmoran()*](https://r-spatial.github.io/spdep/reference/localmoran.html) function of **spdep** will be used. It computes *Ii* values, given a set of *zi* values and a listw object providing neighbour weighting information for the polygon associated with the zi values.\n\nThe code chunks below are used to compute local Moran’s I of *revenue_all* at the province level.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfips <- order(rev_2020$total_revenue)\nlocalMI.2020 <- localmoran(rev_2020$total_revenue, rswm_q_rev_2020)\nhead(localMI.2020)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           Ii          E.Ii      Var.Ii       Z.Ii Pr(z != E(Ii))\n1  0.08453210 -0.0013070248 0.032609705  0.4753482      0.6345388\n2  0.07151076 -0.0012480655 0.023035465  0.4793880      0.6316626\n3 -2.03020664 -0.7678941085 2.134832232 -0.8639429      0.3876193\n4  0.08158788 -0.0012097330 0.030185259  0.4765631      0.6336733\n5  0.04135231 -0.0009206770 0.013409885  0.3650484      0.7150753\n6 -0.23212301 -0.0007307342 0.006372214 -2.8987027      0.0037471\n```\n\n\n:::\n:::\n\n\n\n\n### Interpretation\n\n-   Most provinces show weak clustering or dispersion of tourism revenue, but these are not statistically significant (high p-values).\n\n-   The province in **Row 6** shows significant **dispersion** (i.e., it has a very different tourism revenue compared to its neighboring provinces). This result is statistically significant, indicating that this province is a potential outlier in the spatial distribution of tourism revenue.\n:::\n\nThe code chunk below list the content of the local Moran matrix derived by using [*printCoefmat()*](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/printCoefmat).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprintCoefmat(data.frame(\n  localMI.2020[fips,], \n  row.names=rev_2020$ADM1_EN[fips]),\n  check.names=FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                  Ii        E.Ii      Var.Ii        Z.Ii\nNong Bua Lam Phu          4.6062e-02 -1.3147e-03  3.2802e-02  2.6159e-01\nAmnat Charoen             8.4532e-02 -1.3070e-03  3.2610e-02  4.7535e-01\nYasothon                  8.6775e-02 -1.2768e-03  1.8590e-02  6.4580e-01\nSing Buri                 8.4365e-02 -1.2619e-03  1.8373e-02  6.3171e-01\nPattani                   1.8929e-02 -1.2540e-03  3.1287e-02  1.1410e-01\nAng Thong                 7.1511e-02 -1.2481e-03  2.3035e-02  4.7939e-01\nKalasin                   6.8837e-02 -1.2273e-03  1.4682e-02  5.7824e-01\nChai Nat                  8.4486e-02 -1.2272e-03  2.2651e-02  5.6951e-01\nBueng Kan                 8.1588e-02 -1.2097e-03  3.0185e-02  4.7656e-01\nMaha Sarakham             7.2189e-02 -1.2057e-03  1.7556e-02  5.5393e-01\nSamut Sakhon             -5.1540e-01 -1.1843e-03  2.1860e-02 -3.4779e+00\nNarathiwat                8.7468e-02 -1.1628e-03  4.4121e-02  4.2195e-01\nPhichit                   6.8300e-02 -1.1623e-03  2.1453e-02  4.7424e-01\nUthai Thani               5.0858e-02 -1.1614e-03  1.6912e-02  4.0001e-01\nRoi Et                    8.7108e-02 -1.1587e-03  1.3862e-02  7.4968e-01\nPhayao                    4.9380e-02 -1.1508e-03  2.1243e-02  3.4670e-01\nKamphaeng Phet            7.0877e-02 -1.1412e-03  1.6618e-02  5.5867e-01\nLamphun                  -7.6321e-02 -1.1288e-03  2.8167e-02 -4.4802e-01\nChaiyaphum                3.0092e-02 -1.1218e-03  2.0707e-02  2.1691e-01\nPhrae                     7.9574e-02 -1.1134e-03  1.6214e-02  6.3367e-01\nPathum Thani             -3.1514e-01 -1.0907e-03  1.3050e-02 -2.7491e+00\nSi Sa Ket                 7.9054e-02 -1.0898e-03  2.0117e-02  5.6506e-01\nUttaradit                 7.1715e-02 -1.0691e-03  1.9736e-02  5.1809e-01\nNakhon Phanom             8.1830e-02 -1.0665e-03  2.6615e-02  5.0813e-01\nSakon Nakhon              7.2880e-02 -1.0379e-03  1.2418e-02  6.6331e-01\nYala                      1.9854e-02 -1.0297e-03  2.5698e-02  1.3027e-01\nPhatthalung               2.6822e-03 -1.0255e-03  1.8931e-02  2.6947e-02\nMukdahan                  8.3203e-02 -1.0184e-03  1.2186e-02  7.6293e-01\nRanong                   -2.2536e-02 -1.0177e-03  2.5399e-02 -1.3502e-01\nSurin                     7.9363e-02 -9.9959e-04  1.8454e-02  5.9158e-01\nNan                       7.9301e-02 -9.8010e-04  2.4461e-02  5.1331e-01\nSamut Songkhram           3.7426e-02 -9.4343e-04  2.3547e-02  2.5005e-01\nBuri Ram                  4.1352e-02 -9.2068e-04  1.3410e-02  3.6505e-01\nSukhothai                 6.6232e-02 -9.2013e-04  1.1011e-02  6.3995e-01\nNonthaburi               -4.5989e-01 -9.1640e-04  1.6919e-02 -3.5286e+00\nNakhon Sawan              6.9445e-02 -8.8260e-04  7.6953e-03  8.0171e-01\nSamut Prakan             -9.4591e-01 -8.5910e-04  3.2606e-02 -5.2336e+00\nNakhon Pathom            -2.3754e-01 -8.3241e-04  8.4170e-03 -2.5801e+00\nLampang                  -1.1728e-03 -8.1973e-04  8.2888e-03 -3.8786e-03\nLop Buri                  5.1644e-02 -8.1543e-04  7.1102e-03  6.2214e-01\nSaraburi                  3.9076e-02 -8.1222e-04  1.1831e-02  3.6671e-01\nRatchaburi                2.6644e-02 -8.1190e-04  1.1827e-02  2.5247e-01\nLoei                      4.5308e-02 -7.7880e-04  9.3210e-03  4.7735e-01\nMae Hong Son             -1.2532e-01 -7.7719e-04  2.9500e-02 -7.2514e-01\nNong Khai                 5.8674e-02 -7.6851e-04  1.4191e-02  4.9899e-01\nPrachin Buri              3.5221e-02 -7.6702e-04  1.4164e-02  3.0239e-01\nSuphan Buri               4.9781e-02 -7.6296e-04  7.7153e-03  5.7543e-01\nChumphon                 -3.1647e-02 -7.4365e-04  1.8564e-02 -2.2681e-01\nChachoengsao             -2.3212e-01 -7.3073e-04  6.3722e-03 -2.8987e+00\nSa Kaeo                   3.8748e-02 -6.8198e-04  9.9356e-03  3.9558e-01\nUbon Ratchathani          6.5510e-02 -6.0772e-04  1.5173e-02  5.3676e-01\nTak                       1.1611e-02 -5.5093e-04  4.2084e-03  1.8748e-01\nTrang                    -3.5052e-03 -5.0771e-04  9.3777e-03 -3.0954e-02\nNakhon Nayok              3.6553e-02 -4.9846e-04  7.2633e-03  4.3475e-01\nPhetchabun                4.2049e-02 -4.6332e-04  4.6866e-03  6.2100e-01\nChanthaburi              -4.3068e-02 -4.4461e-04  6.4789e-03 -5.2954e-01\nPhitsanulok               4.6664e-02 -4.1733e-04  4.9966e-03  6.6606e-01\nSatun                     4.6827e-03 -3.8131e-04  9.5222e-03  5.1895e-02\nUdon Thani                3.4444e-02 -2.7198e-04  3.2569e-03  6.0831e-01\nPhra Nakhon Si Ayutthaya  3.4174e-02 -2.2011e-04  2.2271e-03  7.2881e-01\nTrat                      1.2448e-02 -6.0340e-05  4.6459e-03  1.8351e-01\nNakhon Si Thammarat      -1.2179e-02 -5.5327e-05  8.0654e-04 -4.2688e-01\nKhon Kaen                 1.1027e-02 -3.3021e-05  2.5237e-04  6.9618e-01\nPhangnga                  1.1121e-02 -2.6496e-05  6.6192e-04  4.3328e-01\nRayong                    5.1366e-02 -6.6256e-05  2.5167e-03  1.0252e+00\nNakhon Ratchasima        -1.6450e-02 -7.2923e-05  6.3633e-04 -6.4923e-01\nPhetchaburi              -1.1820e-02 -2.1932e-04  5.4779e-03 -1.5674e-01\nChiang Rai                3.3503e-02 -2.7869e-04  6.9604e-03  4.0491e-01\nKanchanaburi             -3.8241e-02 -3.1162e-04  4.5416e-03 -5.6282e-01\nPrachuap Khiri Khan      -1.3118e-02 -7.6751e-04  2.9133e-02 -7.2358e-02\nSongkhla                 -8.6690e-02 -2.0330e-03  2.9579e-02 -4.9223e-01\nSurat Thani               4.3427e-03 -2.5008e-03  3.6367e-02  3.5886e-02\nKrabi                     3.2144e-02 -4.5126e-03  8.3016e-02  1.2722e-01\nChiang Mai               -2.0878e-01 -2.0100e-02  2.8714e-01 -3.5211e-01\nChon Buri                -1.8954e-01 -3.5025e-02  8.4437e-01 -1.6816e-01\nPhuket                    0.0000e+00  0.0000e+00  0.0000e+00         NaN\nBangkok                  -2.0302e+00 -7.6789e-01  2.1348e+00 -8.6394e-01\n                         Pr.z....E.Ii..\nNong Bua Lam Phu                 0.7936\nAmnat Charoen                    0.6345\nYasothon                         0.5184\nSing Buri                        0.5276\nPattani                          0.9092\nAng Thong                        0.6317\nKalasin                          0.5631\nChai Nat                         0.5690\nBueng Kan                        0.6337\nMaha Sarakham                    0.5796\nSamut Sakhon                     0.0005\nNarathiwat                       0.6731\nPhichit                          0.6353\nUthai Thani                      0.6891\nRoi Et                           0.4534\nPhayao                           0.7288\nKamphaeng Phet                   0.5764\nLamphun                          0.6541\nChaiyaphum                       0.8283\nPhrae                            0.5263\nPathum Thani                     0.0060\nSi Sa Ket                        0.5720\nUttaradit                        0.6044\nNakhon Phanom                    0.6114\nSakon Nakhon                     0.5071\nYala                             0.8964\nPhatthalung                      0.9785\nMukdahan                         0.4455\nRanong                           0.8926\nSurin                            0.5541\nNan                              0.6077\nSamut Songkhram                  0.8026\nBuri Ram                         0.7151\nSukhothai                        0.5222\nNonthaburi                       0.0004\nNakhon Sawan                     0.4227\nSamut Prakan                     0.0000\nNakhon Pathom                    0.0099\nLampang                          0.9969\nLop Buri                         0.5339\nSaraburi                         0.7138\nRatchaburi                       0.8007\nLoei                             0.6331\nMae Hong Son                     0.4684\nNong Khai                        0.6178\nPrachin Buri                     0.7624\nSuphan Buri                      0.5650\nChumphon                         0.8206\nChachoengsao                     0.0037\nSa Kaeo                          0.6924\nUbon Ratchathani                 0.5914\nTak                              0.8513\nTrang                            0.9753\nNakhon Nayok                     0.6637\nPhetchabun                       0.5346\nChanthaburi                      0.5964\nPhitsanulok                      0.5054\nSatun                            0.9586\nUdon Thani                       0.5430\nPhra Nakhon Si Ayutthaya         0.4661\nTrat                             0.8544\nNakhon Si Thammarat              0.6695\nKhon Kaen                        0.4863\nPhangnga                         0.6648\nRayong                           0.3053\nNakhon Ratchasima                0.5162\nPhetchaburi                      0.8755\nChiang Rai                       0.6855\nKanchanaburi                     0.5736\nPrachuap Khiri Khan              0.9423\nSongkhla                         0.6226\nSurat Thani                      0.9714\nKrabi                            0.8988\nChiang Mai                       0.7248\nChon Buri                        0.8665\nPhuket                              NaN\nBangkok                          0.3876\n```\n\n\n:::\n:::\n\n\n\n\n**Significant Provinces with Negative Z-scores** (potential outliers):\n\n-   **Samut Sakhon**:\n\n    -   Z.Ii = `-3.4779`\n\n    -   p-value = `0.0005`\n\n    -   Interpretation: Samut Sakhon has significantly different tourism revenue from its neighboring provinces, making it a potential **outlier** in terms of low tourism revenue compared to its neighbors.\n\n-   **Samut Prakan**:\n\n    -   Z.Ii = `-5.2336`\n\n    -   p-value = `0.0000`\n\n    -   Interpretation: Samut Prakan is another **outlier** with significantly different tourism revenue compared to neighboring provinces.\n\n-   **Nakhon Pathom**:\n\n    -   Z.Ii = `-3.8708`\n\n    -   p-value = `0.0001`\n\n    -   Interpretation: Nakhon Pathom also appears to be a significant **outlier** with very different tourism revenue from its neighbors.\n\n-   **Chumphon**:\n\n    -   Z.Ii = `-3.9273`\n\n    -   p-value = `0.0001`\n\n    -   Interpretation: Chumphon shows a significant dispersion, suggesting that its tourism revenue is an outlier compared to nearby provinces.\n\n##### Mapping both local Moran’s I values and p-values\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2020.localMI <- cbind(rev_2020,localMI.2020) %>%\n  rename(Pr.Ii = Pr.z....E.Ii..)\n```\n:::\n\n\n\n\nFor effective interpretation, it is better to plot both the local Moran’s I values map and its corresponding p-values map next to each other.\n\nThe code chunk below will be used to create such visualisation.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlocalMI.2020.map <- tm_shape(rev_2020.localMI) +\n  tm_fill(col = \"Ii\", \n          style = \"pretty\", \n          title = \"local moran statistics\") +\n  tm_borders(alpha = 0.5)\n\npvalue.2020.map <- tm_shape(rev_2020.localMI) +\n  tm_fill(col = \"Pr.Ii\", \n          breaks=c(-Inf, 0.001, 0.01, 0.05, 0.1, Inf),\n          palette=\"-Blues\", \n          title = \"local Moran's I p-values\") +\n  tm_borders(alpha = 0.5)\n\ntmap_arrange(localMI.2020.map, pvalue.2020.map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-52-1.png){width=672}\n:::\n:::\n\n\n\n\n##### Cluster Identification (HH, LL, HL, LH)\n\nWe can classify the results into clusters: High-High (HH), Low-Low (LL), High-Low (HL), and Low-High (LH) based on z-scores.\n\n-   **Hotspots (HH)**: Provinces that have high values and are surrounded by neighbors with high values. These are tourism revenue hotspots.\n\n-   **Cold spots (LL)**: Provinces with low values surrounded by neighbors with low values.\n\n-   **High-Low (HL)** and **Low-High (LH)** indicate outliers where a province's value is higher or lower than its neighbors.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2020$cluster <- ifelse(localMI.2020[,5] < 0.05,  # p-value significance\n                                   ifelse(localMI.2020[,4] > 0, \"HH\", \"LL\"), \"Not Significant\")\n```\n:::\n\n\n\n\n##### Visualize the Results Using ggplot2\n\nTo map the identified clusters, we can use ggplot2.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(rev_2020) +\n  geom_sf(aes(fill = cluster)) +\n  scale_fill_manual(values = c(\"HH\" = \"red\", \"LL\" = \"blue\", \"Not Significant\" = \"grey\")) +\n  theme_minimal() +\n  labs(title = \"Local Moran's I - Revenue Clusters\",\n       fill = \"Cluster\")\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-54-1.png){width=672}\n:::\n:::\n\n\n\n\nInterpretation of the Map:\n\n1.  **Blue Areas (LL Clusters)**:\n\n    -   The provinces shaded in **blue** are showing **low-low clusters**. This means that these provinces have **low tourism revenue**, and they are surrounded by other provinces with similarly low tourism revenue.\n\n    -   These areas could potentially represent regions where tourism activities are generally lower, and this pattern holds across neighboring provinces. In this context, **southern provinces of central Thailand** appear to have clusters of low tourism revenue.\n\n2.  **Gray Areas (Not Significant)**:\n\n    -   The **gray provinces** show no statistically significant spatial autocorrelation in tourism revenue. In these areas, tourism revenue may not follow any specific clustering pattern, either high-high or low-low. These provinces have tourism revenue that does not have a strong relationship with their neighboring provinces in terms of similarities or dissimilarities.\n\n3.  **Unshaded or NA Areas**:\n\n    -   These regions either have missing data or were excluded from the analysis for some reason (such as having no valid neighboring regions to analyze).\n\nImplications of the Results:\n\n-   The **Low-Low (LL)** clusters may indicate areas where tourism infrastructure or marketing efforts are weaker, or where attractions are less developed compared to other regions. These regions might benefit from targeted interventions to improve tourism and boost revenue.\n\n-   The **Not Significant** regions may be areas where local factors (such as local attractions, accessibility, or provincial policies) are more important drivers of tourism revenue, without strong influence from neighboring provinces.\n\n##### Local Geary's C\n\nFor more precise local autocorrelation, we can also compute **Local Geary's C**. This measures dissimilarities between neighbors.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate Local Geary's C for 'revenue_all' using the correct function localC()\nlocal_geary_rev_2020 <- localC(rev_2020$total_revenue, rswm_q_rev_2020, zero.policy = TRUE)\n\n# Add Local Geary's C to the dataset for 'revenue_all'\nrev_2020$local_geary <- local_geary_rev_2020\n\n# Plot the results using ggplot\nggplot(rev_2020) +\n  geom_sf(aes(fill = local_geary)) +\n  theme_minimal() +\n  labs(title = \"Local Geary's C - Revenue clusters\", fill = \"Geary's C\")\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-55-1.png){width=672}\n:::\n:::\n\n\n\n\nInterpretation of the Map:\n\n1.  **Provinces with Higher Geary’s C (Darker Blue)**:\n\n    -   Provinces that are shaded in **darker blue** have higher Geary’s C values, indicating that their tourism revenues are quite different from neighboring provinces. These provinces may be outliers with respect to their neighbors.\n\n    -   In your map, there are darker blue provinces, indicating that these areas have substantial differences in tourism revenue compared to their neighbors.\n\n2.  **Provinces with Lower Geary’s C (Lighter Blue)**:\n\n    -   The **lighter blue** regions have lower Geary’s C values, meaning that the tourism revenue in these provinces is more similar to that of their neighboring provinces. These regions might form clusters where provinces exhibit similar tourism revenue patterns.\n\nImplications of the Results:\n\n-   **High Geary’s C values** (darker blue areas) indicate provinces where the tourism revenue is **significantly different** from neighboring provinces. These areas might warrant further investigation to understand the reasons behind this discrepancy (e.g., unique attractions, significant tourism policies, or infrastructure differences).\n\n-   **Low Geary’s C values** (lighter blue areas) indicate provinces where the tourism revenue is **similar to neighboring provinces**, forming clusters of similarity.\n\n##### **Creating a LISA Cluster Map**\n\nThe Moran scatterplot is an illustration of the relationship between the values of the chosen attribute at each location and the average value of the same attribute at neighboring locations.\n\nThe code chunk below plots the Moran scatterplot of rev_2020 by using [*moran.plot()*](https://r-spatial.github.io/spdep/reference/moran.plot.html) of **spdep**.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2020$Z.total_revenue <- scale(rev_2020$total_revenue) %>% \n  as.vector \n\nnci2 <- moran.plot(rev_2020$Z.total_revenue, rswm_q_rev_2020,\n                   labels=as.character(rev_2020$ADM1_EN),\n                   xlab=\"z-rev_2020\", \n                   ylab=\"Spatially Lag z-rev_2020\")\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-56-1.png){width=672}\n:::\n:::\n\n\n\n\n##### **Plotting LISA map**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquadrant <- vector(mode=\"numeric\",length=nrow(localMI.2020))\nrev_2020$lag_total_revenue <- lag.listw(rswm_q_rev_2020, rev_2020$total_revenue)\nDV <- rev_2020$lag_total_revenue - mean(rev_2020$lag_total_revenue)     \nLM_I <- localMI.2020[,1]   \nsignif <- 0.05       \nquadrant[DV <0 & LM_I>0] <- 1\nquadrant[DV >0 & LM_I<0] <- 2\nquadrant[DV <0 & LM_I<0] <- 3  \nquadrant[DV >0 & LM_I>0] <- 4    \nquadrant[localMI.2020[,5]>signif] <- 0\n\nrev_2020.localMI$quadrant <- quadrant\ncolors <- c(\"#ffffff\", \"#2c7bb6\", \"#abd9e9\", \"#fdae61\", \"#d7191c\")\nclusters <- c(\"insignificant\", \"low-low\", \"low-high\", \"high-low\", \"high-high\")\n\ntm_shape(rev_2020.localMI) +\n  tm_fill(col = \"quadrant\", \n          style = \"cat\", \n          palette = colors[c(sort(unique(quadrant)))+1], \n          labels = clusters[c(sort(unique(quadrant)))+1],\n          popup.vars = c(\"\")) +\n  tm_view(set.zoom.limits = c(11,17)) +\n  tm_borders(alpha=0.5)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-57-1.png){width=672}\n:::\n:::\n\n\n\n\n**Provinces like Bangkok, Samut Sakhon, and Nonthaburi** seem to fall into the Low-High quadrant on your spatial analysis map. These provinces are performing lower in tourism revenue despite being surrounded by higher-performing neighbors. You could focus on this region for further investigation.\n\n#### Recovering Year: 2022\n\n##### Local Moran's I Calculation\n\n::: panel-tabset\n### Local Moran's I\n\nTo compute local Moran’s I, the [*localmoran()*](https://r-spatial.github.io/spdep/reference/localmoran.html) function of **spdep** will be used. It computes *Ii* values, given a set of *zi* values and a listw object providing neighbour weighting information for the polygon associated with the zi values.\n\nThe code chunks below are used to compute local Moran’s I of *revenue_all* at the province level.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfips <- order(rev_2022$total_revenue)\nlocalMI.2022 <- localmoran(rev_2022$total_revenue, rswm_q_rev_2022)\nhead(localMI.2022)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           Ii         E.Ii      Var.Ii       Z.Ii Pr(z != E(Ii))\n1  0.08264012 -0.001231751 0.030733967  0.4784174    0.632353118\n2  0.05635604 -0.001157218 0.021360637  0.3935146    0.693939421\n3 -1.76468576 -0.686489107 2.577879048 -0.6715320    0.501881681\n4  0.07404165 -0.001109102 0.027677091  0.4517239    0.651467863\n5  0.03615841 -0.000430189 0.006268884  0.4621156    0.643998399\n6 -0.18988537 -0.000514824 0.004490384 -2.8259905    0.004713466\n```\n\n\n:::\n:::\n\n\n\n\n### Interpretation\n\n-   Most provinces show weak clustering or dispersion of tourism revenue, but these are not statistically significant (high p-values).\n\n-   The province in **Row 6** shows significant **dispersion** (i.e., it has a very different tourism revenue compared to its neighboring provinces). This result is statistically significant, indicating that this province is a potential outlier in the spatial distribution of tourism revenue.\n:::\n\nThe code chunk below list the content of the local Moran matrix derived by using [*printCoefmat()*](https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/printCoefmat).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprintCoefmat(data.frame(\n  localMI.2022[fips,], \n  row.names=rev_2022$ADM1_EN[fips]),\n  check.names=FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                  Ii        E.Ii      Var.Ii        Z.Ii\nNong Bua Lam Phu          5.2953e-02 -1.2371e-03  3.0866e-02  3.0844e-01\nAmnat Charoen             8.2640e-02 -1.2318e-03  3.0734e-02  4.7842e-01\nYasothon                  8.4316e-02 -1.1989e-03  1.7458e-02  6.4721e-01\nPattani                   5.2044e-02 -1.1744e-03  2.9305e-02  3.1088e-01\nMaha Sarakham             6.8733e-02 -1.1718e-03  1.7064e-02  5.3514e-01\nKalasin                   6.9212e-02 -1.1607e-03  1.3886e-02  5.9718e-01\nAng Thong                 5.6356e-02 -1.1572e-03  2.1361e-02  3.9351e-01\nSamut Sakhon             -4.8115e-01 -1.1487e-03  2.1203e-02 -3.2964e+00\nPhatthalung               4.1381e-02 -1.1450e-03  2.1136e-02  2.9251e-01\nSing Buri                 7.2041e-02 -1.1395e-03  1.6594e-02  5.6810e-01\nRoi Et                    8.4473e-02 -1.1372e-03  1.3606e-02  7.3394e-01\nNarathiwat                8.2875e-02 -1.1362e-03  4.3113e-02  4.0461e-01\nBueng Kan                 7.4042e-02 -1.1091e-03  2.7677e-02  4.5172e-01\nChai Nat                  7.2733e-02 -1.0968e-03  2.0246e-02  5.1888e-01\nSi Sa Ket                 8.0778e-02 -1.0930e-03  2.0177e-02  5.7637e-01\nPhichit                   6.0457e-02 -1.0851e-03  2.0032e-02  4.3482e-01\nRanong                    1.1193e-02 -1.0694e-03  2.6689e-02  7.5062e-02\nUttaradit                 6.6753e-02 -1.0563e-03  1.9500e-02  4.8559e-01\nUthai Thani               4.2989e-02 -1.0543e-03  1.5354e-02  3.5545e-01\nKamphaeng Phet            6.4953e-02 -1.0469e-03  1.5246e-02  5.3452e-01\nLamphun                  -5.4804e-02 -1.0368e-03  2.5875e-02 -3.3426e-01\nChaiyaphum                3.9449e-02 -1.0252e-03  1.8927e-02  2.9420e-01\nSurin                     7.3675e-02 -1.0143e-03  1.8724e-02  5.4582e-01\nPhayao                    1.8309e-02 -9.6423e-04  1.7802e-02  1.4445e-01\nRatchaburi                1.8543e-02 -9.5284e-04  1.3878e-02  1.6549e-01\nPathum Thani             -2.8142e-01 -9.3709e-04  1.1214e-02 -2.6487e+00\nSukhothai                 6.2969e-02 -9.3104e-04  1.1141e-02  6.0539e-01\nSakon Nakhon              6.7450e-02 -9.2609e-04  1.1082e-02  6.4952e-01\nYala                      4.9173e-02 -9.2601e-04  2.3112e-02  3.2954e-01\nNakhon Phanom             7.1459e-02 -9.0709e-04  2.2641e-02  4.8094e-01\nMukdahan                  7.5069e-02 -8.9533e-04  1.0714e-02  7.3387e-01\nPhrae                     6.6207e-02 -8.7807e-04  1.2790e-02  5.9318e-01\nPrachin Buri              4.7079e-02 -8.1884e-04  1.5120e-02  3.8953e-01\nUbon Ratchathani          7.3948e-02 -8.0653e-04  2.0133e-02  5.2685e-01\nNan                       6.5875e-02 -7.7868e-04  1.9438e-02  4.7808e-01\nNonthaburi               -4.0297e-01 -7.6596e-04  1.4144e-02 -3.3819e+00\nChumphon                 -3.4512e-02 -7.6551e-04  1.9109e-02 -2.4412e-01\nLoei                      4.6254e-02 -7.4829e-04  8.9561e-03  4.9666e-01\nNong Khai                 5.7619e-02 -7.4042e-04  1.3673e-02  4.9910e-01\nSamut Prakan             -8.2839e-01 -7.3178e-04  2.7778e-02 -4.9659e+00\nNakhon Nayok              4.6048e-02 -7.2917e-04  1.0623e-02  4.5385e-01\nSa Kaeo                   4.3109e-02 -7.1055e-04  1.0351e-02  4.3069e-01\nTrang                     3.5837e-02 -7.0147e-04  1.2954e-02  3.2103e-01\nNakhon Pathom            -2.0652e-01 -6.8775e-04  6.9553e-03 -2.4681e+00\nNakhon Sawan              5.5285e-02 -6.3526e-04  5.5402e-03  7.5129e-01\nMae Hong Son             -8.7707e-02 -6.2658e-04  2.3787e-02 -5.6461e-01\nLampang                  -5.5240e-03 -6.2605e-04  6.3317e-03 -6.1554e-02\nSamut Songkhram           2.3757e-02 -5.8935e-04  1.4715e-02  2.0071e-01\nSuphan Buri               3.8355e-02 -5.8374e-04  5.9040e-03  5.0677e-01\nChanthaburi              -5.2228e-02 -5.8118e-04  8.4679e-03 -5.6125e-01\nLop Buri                  4.0788e-02 -5.7133e-04  4.9829e-03  5.8592e-01\nTak                       1.3511e-02 -5.4588e-04  4.1698e-03  2.1769e-01\nChachoengsao             -1.8989e-01 -5.1482e-04  4.4904e-03 -2.8260e+00\nNakhon Si Thammarat       5.5668e-03 -4.6244e-04  6.7387e-03  7.3447e-02\nBuri Ram                  3.6158e-02 -4.3019e-04  6.2689e-03  4.6212e-01\nSatun                     2.9243e-02 -4.2289e-04  1.0560e-02  2.8868e-01\nUdon Thani                4.2796e-02 -4.1449e-04  4.9626e-03  6.1339e-01\nPhangnga                 -3.2831e-03 -4.1016e-04  1.0242e-02 -2.8387e-02\nPhitsanulok               4.4353e-02 -4.0197e-04  4.8127e-03  6.4513e-01\nSaraburi                  2.9571e-02 -4.0117e-04  5.8462e-03  3.9200e-01\nPhetchabun                3.5698e-02 -3.6042e-04  3.6462e-03  5.9715e-01\nTrat                      2.4525e-02 -1.7917e-04  1.3794e-02  2.1034e-01\nKhon Kaen                 2.3068e-02 -1.3725e-04  1.0489e-03  7.1652e-01\nRayong                   -8.1578e-02 -1.2461e-04  4.7329e-03 -1.1840e+00\nNakhon Ratchasima         1.8553e-02 -1.0490e-04  9.1531e-04  6.1671e-01\nPhra Nakhon Si Ayutthaya  1.0885e-02 -2.8862e-05  2.9208e-04  6.3863e-01\nSongkhla                 -8.9588e-03 -1.7571e-05  2.5615e-04 -5.5866e-01\nKrabi                    -3.0162e-03 -2.2015e-05  4.0683e-04 -1.4844e-01\nKanchanaburi             -3.9055e-02 -3.5129e-04  5.1195e-03 -5.4092e-01\nPhetchaburi              -5.0393e-03 -6.8281e-04  1.7046e-02 -3.3367e-02\nSurat Thani              -5.0961e-02 -1.1840e-03  1.7241e-02 -3.7909e-01\nPrachuap Khiri Khan      -2.7765e-03 -2.2593e-03  8.5629e-02 -1.7675e-03\nChiang Rai                7.7662e-02 -2.6548e-03  6.6146e-02  3.1229e-01\nChiang Mai               -9.5021e-02 -1.3357e-02  1.9212e-01 -1.8631e-01\nChon Buri                -3.1778e-01 -4.6839e-02  1.1153e+00 -2.5655e-01\nPhuket                    0.0000e+00  0.0000e+00  0.0000e+00         NaN\nBangkok                  -1.7647e+00 -6.8649e-01  2.5779e+00 -6.7153e-01\n                         Pr.z....E.Ii..\nNong Bua Lam Phu                 0.7577\nAmnat Charoen                    0.6324\nYasothon                         0.5175\nPattani                          0.7559\nMaha Sarakham                    0.5926\nKalasin                          0.5504\nAng Thong                        0.6939\nSamut Sakhon                     0.0010\nPhatthalung                      0.7699\nSing Buri                        0.5700\nRoi Et                           0.4630\nNarathiwat                       0.6858\nBueng Kan                        0.6515\nChai Nat                         0.6038\nSi Sa Ket                        0.5644\nPhichit                          0.6637\nRanong                           0.9402\nUttaradit                        0.6273\nUthai Thani                      0.7223\nKamphaeng Phet                   0.5930\nLamphun                          0.7382\nChaiyaphum                       0.7686\nSurin                            0.5852\nPhayao                           0.8851\nRatchaburi                       0.8686\nPathum Thani                     0.0081\nSukhothai                        0.5449\nSakon Nakhon                     0.5160\nYala                             0.7417\nNakhon Phanom                    0.6306\nMukdahan                         0.4630\nPhrae                            0.5531\nPrachin Buri                     0.6969\nUbon Ratchathani                 0.5983\nNan                              0.6326\nNonthaburi                       0.0007\nChumphon                         0.8071\nLoei                             0.6194\nNong Khai                        0.6177\nSamut Prakan                     0.0000\nNakhon Nayok                     0.6499\nSa Kaeo                          0.6667\nTrang                            0.7482\nNakhon Pathom                    0.0136\nNakhon Sawan                     0.4525\nMae Hong Son                     0.5723\nLampang                          0.9509\nSamut Songkhram                  0.8409\nSuphan Buri                      0.6123\nChanthaburi                      0.5746\nLop Buri                         0.5579\nTak                              0.8277\nChachoengsao                     0.0047\nNakhon Si Thammarat              0.9415\nBuri Ram                         0.6440\nSatun                            0.7728\nUdon Thani                       0.5396\nPhangnga                         0.9774\nPhitsanulok                      0.5188\nSaraburi                         0.6951\nPhetchabun                       0.5504\nTrat                             0.8334\nKhon Kaen                        0.4737\nRayong                           0.2364\nNakhon Ratchasima                0.5374\nPhra Nakhon Si Ayutthaya         0.5231\nSongkhla                         0.5764\nKrabi                            0.8820\nKanchanaburi                     0.5886\nPhetchaburi                      0.9734\nSurat Thani                      0.7046\nPrachuap Khiri Khan              0.9986\nChiang Rai                       0.7548\nChiang Mai                       0.8522\nChon Buri                        0.7975\nPhuket                              NaN\nBangkok                          0.5019\n```\n\n\n:::\n:::\n\n\n\n\n**High and Significant Positive Ii Values (Clustering)**:\n\n-   **Nong Bua Lam Phu**:\n\n    -   **Ii = 5.2953e-01**, **Z.Ii = 3.0844e-01**, **p-value = 0.7577**\n\n    -   This province shows a positive Ii value but the p-value indicates that it is **not significant**, meaning the clustering could be due to chance.\n\n**Negative Ii Values with Significant P-values (Outliers)**:\n\n-   **Nonthaburi**:\n\n    -   **Ii = -4.0297e-01**, **Z.Ii = -3.3819e+00**, **p-value = 0.0007**\n\n    -   Nonthaburi has a significantly **negative Ii** value and a very low p-value, indicating that it is an **outlier** in terms of tourism revenue compared to its neighbors. This suggests that Nonthaburi's revenue is dissimilar to the surrounding provinces.\n\n-   **Samut Sakhon**:\n\n    -   **Ii = -2.9936e-01**, **Z.Ii = -3.4779e+00**, **p-value = 0.0005**\n\n    -   Similar to Nonthaburi, Samut Sakhon shows a **negative Moran's I statistic** with a highly significant p-value, indicating it is an outlier with respect to its neighbors in tourism revenue.\n\n**High Ii Values with Low P-values (Clustering)**:\n\n-   **Surat Thani**:\n\n    -   **Ii = 3.2158e-01**, **Z.Ii = 1.7075e+00**, **p-value = 0.0876**\n\n    -   Surat Thani shows **positive clustering**, but the p-value (0.0876) suggests that it is not statistically significant. This means its high tourism revenue compared to its neighbors might not form a significant spatial pattern.\n\nIdentifying Potential Outliers:\n\n-   **Nonthaburi** and **Samut Sakhon** are **significant outliers**. They both have **negative Moran's I values** and **low p-values**, indicating that their tourism revenues are **lower than expected** compared to neighboring provinces.\n\n-   Provinces like **Surat Thani** and **Amnat Charoen** show **positive clustering**, but their results are not statistically significant, meaning the observed clustering might be due to random variation.\n\n##### Mapping both local Moran’s I values and p-values\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2022.localMI <- cbind(rev_2022,localMI.2022) %>%\n  rename(Pr.Ii = Pr.z....E.Ii..)\n```\n:::\n\n\n\n\nFor effective interpretation, it is better to plot both the local Moran’s I values map and its corresponding p-values map next to each other.\n\nThe code chunk below will be used to create such visualisation.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlocalMI.2022.map <- tm_shape(rev_2022.localMI) +\n  tm_fill(col = \"Ii\", \n          style = \"pretty\", \n          title = \"local moran statistics\") +\n  tm_borders(alpha = 0.5)\n\npvalue.2022.map <- tm_shape(rev_2022.localMI) +\n  tm_fill(col = \"Pr.Ii\", \n          breaks=c(-Inf, 0.001, 0.01, 0.05, 0.1, Inf),\n          palette=\"-Blues\", \n          title = \"local Moran's I p-values\") +\n  tm_borders(alpha = 0.5)\n\ntmap_arrange(localMI.2022.map, pvalue.2022.map, asp=1, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-61-1.png){width=672}\n:::\n:::\n\n\n\n\n##### Add Moran's I Results to Dataset\n\nWe append the results of Local Moran's I to the dataset for further analysis.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2022$local_moran <- localMI.2022[,1]\n```\n:::\n\n\n\n\n##### Cluster Identification (HH, LL, HL, LH)\n\nWe can classify the results into clusters: High-High (HH), Low-Low (LL), High-Low (HL), and Low-High (LH) based on z-scores.\n\n-   **Hotspots (HH)**: Provinces that have high values and are surrounded by neighbors with high values. These are tourism revenue hotspots.\n\n-   **Cold spots (LL)**: Provinces with low values surrounded by neighbors with low values.\n\n-   **High-Low (HL)** and **Low-High (LH)** indicate outliers where a province's value is higher or lower than its neighbors.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2022$cluster <- ifelse(localMI.2022[,5] < 0.05,  # p-value significance\n                                   ifelse(localMI.2022[,4] > 0, \"HH\", \"LL\"), \"Not Significant\")\n```\n:::\n\n\n\n\n##### Visualize the Results Using ggplot2\n\nTo map the identified clusters, we can use ggplot2.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(rev_2022) +\n  geom_sf(aes(fill = cluster)) +\n  scale_fill_manual(values = c(\"HH\" = \"red\", \"LL\" = \"blue\", \"Not Significant\" = \"grey\")) +\n  theme_minimal() +\n  labs(title = \"Local Moran's I - Revenue Clusters\",\n       fill = \"Cluster\")\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-64-1.png){width=672}\n:::\n:::\n\n\n\n\nInterpretation of the Map:\n\n1.  **Blue Areas (LL Clusters)**:\n\n    -   The provinces shaded in **blue** are showing **low-low clusters**. This means that these provinces have **low tourism revenue**, and they are surrounded by other provinces with similarly low tourism revenue.\n\n    -   These areas could potentially represent regions where tourism activities are generally lower, and this pattern holds across neighboring provinces. In this context, **southern provinces of central Thailand** appear to have clusters of low tourism revenue.\n\n2.  **Gray Areas (Not Significant)**:\n\n    -   The **gray provinces** show no statistically significant spatial autocorrelation in tourism revenue. In these areas, tourism revenue may not follow any specific clustering pattern, either high-high or low-low. These provinces have tourism revenue that does not have a strong relationship with their neighboring provinces in terms of similarities or dissimilarities.\n\n3.  **Unshaded or NA Areas**:\n\n    -   These regions either have missing data or were excluded from the analysis for some reason (such as having no valid neighboring regions to analyze).\n\nImplications of the Results:\n\n-   The **Low-Low (LL)** clusters may indicate areas where tourism infrastructure or marketing efforts are weaker, or where attractions are less developed compared to other regions. These regions might benefit from targeted interventions to improve tourism and boost revenue.\n\n-   The **Not Significant** regions may be areas where local factors (such as local attractions, accessibility, or provincial policies) are more important drivers of tourism revenue, without strong influence from neighboring provinces.\n\n##### Local Geary's C\n\nFor more precise local autocorrelation, we can also compute **Local Geary's C**. This measures dissimilarities between neighbors.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate Local Geary's C for 'revenue_all' using the correct function localC()\nlocal_geary_rev_2022 <- localC(rev_2022$total_revenue, rswm_q_rev_2022, zero.policy = TRUE)\n\n# Add Local Geary's C to the dataset for 'revenue_all'\nrev_2022$local_geary <- local_geary_rev_2022\n\n# Plot the results using ggplot\nggplot(rev_2022) +\n  geom_sf(aes(fill = local_geary)) +\n  theme_minimal() +\n  labs(title = \"Local Geary's C - Revenue clusters\", fill = \"Geary's C\")\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-65-1.png){width=672}\n:::\n:::\n\n\n\n\nInterpretation of the Map:\n\n1.  **Provinces with Higher Geary’s C (Darker Blue)**:\n\n    -   Provinces that are shaded in **darker blue** have higher Geary’s C values, indicating that their tourism revenues are quite different from neighboring provinces. These provinces may be outliers with respect to their neighbors.\n\n    -   In your map, there are darker blue provinces, indicating that these areas have substantial differences in tourism revenue compared to their neighbors.\n\n2.  **Provinces with Lower Geary’s C (Lighter Blue)**:\n\n    -   The **lighter blue** regions have lower Geary’s C values, meaning that the tourism revenue in these provinces is more similar to that of their neighboring provinces. These regions might form clusters where provinces exhibit similar tourism revenue patterns.\n\nImplications of the Results:\n\n-   **High Geary’s C values** (darker blue areas) indicate provinces where the tourism revenue is **significantly different** from neighboring provinces. These areas might warrant further investigation to understand the reasons behind this discrepancy (e.g., unique attractions, significant tourism policies, or infrastructure differences).\n\n-   **Low Geary’s C values** (lighter blue areas) indicate provinces where the tourism revenue is **similar to neighboring provinces**, forming clusters of similarity.\n\n##### **Creating a LISA Cluster Map**\n\nThe Moran scatterplot is an illustration of the relationship between the values of the chosen attribute at each location and the average value of the same attribute at neighboring locations.\n\nThe code chunk below plots the Moran scatterplot of rev_2020 by using [*moran.plot()*](https://r-spatial.github.io/spdep/reference/moran.plot.html) of **spdep**.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrev_2022$Z.total_revenue <- scale(rev_2022$total_revenue) %>% \n  as.vector \n\nnci2 <- moran.plot(rev_2022$Z.total_revenue, rswm_q_rev_2022,\n                   labels=as.character(rev_2020$ADM1_EN),\n                   xlab=\"z-rev_2022\", \n                   ylab=\"Spatially Lag z-rev_2022\")\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-66-1.png){width=672}\n:::\n:::\n\n\n\n\n##### **Plotting LISA map**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquadrant <- vector(mode=\"numeric\",length=nrow(localMI.2022))\nrev_2022$lag_total_revenue <- lag.listw(rswm_q_rev_2022, rev_2022$total_revenue)\nDV <- rev_2022$lag_total_revenue - mean(rev_2022$lag_total_revenue)     \nLM_I <- localMI.2022[,1]   \nsignif <- 0.05       \nquadrant[DV <0 & LM_I>0] <- 1\nquadrant[DV >0 & LM_I<0] <- 2\nquadrant[DV <0 & LM_I<0] <- 3  \nquadrant[DV >0 & LM_I>0] <- 4    \nquadrant[localMI.2022[,5]>signif] <- 0\n\nrev_2022.localMI$quadrant <- quadrant\ncolors <- c(\"#ffffff\", \"#2c7bb6\", \"#abd9e9\", \"#fdae61\", \"#d7191c\")\nclusters <- c(\"insignificant\", \"low-low\", \"low-high\", \"high-low\", \"high-high\")\n\ntm_shape(rev_2022.localMI) +\n  tm_fill(col = \"quadrant\", \n          style = \"cat\", \n          palette = colors[c(sort(unique(quadrant)))+1], \n          labels = clusters[c(sort(unique(quadrant)))+1],\n          popup.vars = c(\"\")) +\n  tm_view(set.zoom.limits = c(11,17)) +\n  tm_borders(alpha=0.5)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-67-1.png){width=672}\n:::\n:::\n\n\n\n\n## Emerging Hotspot Analysis\n\nEmerging hotspot analysis is used to detect how spatial patterns evolve over time. In this step, we will use spatio-temporal methods to analyze the evolution of tourism revenue and identify areas where hotspots are forming or declining. This will help reveal which provinces are experiencing an increase or decrease in tourism revenue over time.\n\n### **Gi statistics using adaptive distance**\n\nThe code chunk below are used to compute the Gi values for rev_2020 and rev_2022 by using an adaptive distance weight matrix (i.e *knb_lw*).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#For Pandemic Year: 2020\nlongitude_2020 <- map_dbl(rev_2020$geometry, ~st_centroid(.x)[[1]])\nlatitude_2020 <- map_dbl(rev_2020$geometry, ~st_centroid(.x)[[2]])\ncoords_2020 <- cbind(longitude_2020, latitude_2020)\nk1_2020 <- knn2nb(knearneigh(coords_2020))\nk1dists_2020 <- unlist(nbdists(k1_2020, coords_2020, longlat = TRUE))\nknn_2020 <- knn2nb(knearneigh(coords_2020, k=8))\nknn_lw_2020 <- nb2listw(knn_2020, style = 'B')\nsummary(knn_lw_2020)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCharacteristics of weights list object:\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 616 \nPercentage nonzero weights: 10.38961 \nAverage number of links: 8 \nNon-symmetric neighbours list\nLink number distribution:\n\n 8 \n77 \n77 least connected regions:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 8 links\n77 most connected regions:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 8 links\n\nWeights style: B \nWeights constants summary:\n   n   nn  S0   S1    S2\nB 77 5929 616 1090 20478\n```\n\n\n:::\n\n```{.r .cell-code}\n#For Pandemic Year: 2022\nlongitude_2022 <- map_dbl(rev_2022$geometry, ~st_centroid(.x)[[1]])\nlatitude_2022 <- map_dbl(rev_2022$geometry, ~st_centroid(.x)[[2]])\ncoords_2022 <- cbind(longitude_2022, latitude_2022)\nk1_2022 <- knn2nb(knearneigh(coords_2022))\nk1dists_2022 <- unlist(nbdists(k1_2022, coords_2022, longlat = TRUE))\nknn_2022 <- knn2nb(knearneigh(coords_2022, k=8))\nknn_lw_2022 <- nb2listw(knn_2022, style = 'B')\nsummary(knn_lw_2022)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCharacteristics of weights list object:\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 616 \nPercentage nonzero weights: 10.38961 \nAverage number of links: 8 \nNon-symmetric neighbours list\nLink number distribution:\n\n 8 \n77 \n77 least connected regions:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 8 links\n77 most connected regions:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 with 8 links\n\nWeights style: B \nWeights constants summary:\n   n   nn  S0   S1    S2\nB 77 5929 616 1090 20478\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# For rev_2020\nfips <- order(rev_2020$ADM1_EN)\ngi.adaptive <- localG(rev_2020$total_revenue, knn_lw_2020)\nrev_2020.gi <- cbind(rev_2020, as.matrix(gi.adaptive)) %>%\n  rename(gstat_adaptive = as.matrix.gi.adaptive.)\n\n# For rev_2022\nfips <- order(rev_2022$ADM1_EN)\ngi.adaptive <- localG(rev_2022$total_revenue, knn_lw_2022)\nrev_2022.gi <- cbind(rev_2022, as.matrix(gi.adaptive)) %>%\n  rename(gstat_adaptive = as.matrix.gi.adaptive.)\n```\n:::\n\n\n\n\nIt is time for us to visualise the locations of hot spot and cold spot areas. The choropleth mapping functions of **tmap** package will be used to map the Gi values.\n\nThe code chunk below shows the functions used to map the Gi values derived using fixed distance weight matrix.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# For rev_2020\nrevenue_2020 <- qtm(rev_2020, \"total_revenue\")\n\nGimap_2020 <- tm_shape(rev_2020.gi) + \n  tm_fill(col = \"gstat_adaptive\", \n          style = \"pretty\", \n          palette=\"-RdBu\", \n          title = \"local Gi\") + \n  tm_borders(alpha = 0.5)\n\ntmap_arrange(revenue_2020, \n             Gimap_2020, \n             asp=1, \n             ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-70-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# For rev_2022\nrevenue_2022<- qtm(rev_2022, \"total_revenue\")\n\nGimap_2022 <- tm_shape(rev_2022.gi) + \n  tm_fill(col = \"gstat_adaptive\", \n          style = \"pretty\", \n          palette=\"-RdBu\", \n          title = \"local Gi\") + \n  tm_borders(alpha = 0.5)\n\ntmap_arrange(revenue_2022, \n             Gimap_2022, \n             asp=1, \n             ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-homeExercise2_files/figure-html/unnamed-chunk-71-1.png){width=672}\n:::\n:::\n\n\n\n\n### Interpretation of the Emerging Hotspot Analysis (2020 vs 2022):\n\nThis analysis compares **tourism revenue** across Thailand’s provinces in **2020** (during COVID-19) and **2022** (post-COVID-19). The maps show two main elements for both years:\n\n1.  **Total Revenue (Left Maps)**:\n\n    -   The left maps in both 2020 and 2022 display the **total tourism revenue** in each province.\n\n    -   Darker shades represent higher tourism revenue, while lighter shades represent lower revenue.\n\n2.  **Local Gi (Right Maps)**:\n\n    -   The right maps display **Local Gi** statistics, indicating spatial autocorrelation and clustering of high or low tourism revenue.\n\n    -   **Blue areas**: Provinces with low tourism revenue surrounded by provinces with similarly low revenue (Low-Low clusters).\n\n    -   **Red areas**: Provinces with high tourism revenue surrounded by other provinces with similarly high revenue (High-High clusters).\n\n    -   **Light orange areas**: These represent transition zones or areas where local tourism revenue is moderately higher or lower than their neighbors.\n\n### Observations and Changes Between 2020 and 2022:\n\n1.  **Total Revenue (Left Maps)**:\n\n    -   **2020 (During COVID-19)**:\n\n        -   Overall, the tourism revenue in most provinces is **very low**, with only a few provinces (primarily around **Bangkok** and the central region) showing slightly higher revenue.\n\n        -   This reflects the impact of COVID-19, where most regions experienced a significant drop in tourism revenue.\n\n    -   **2022 (Post-COVID-19)**:\n\n        -   Tourism revenue remains relatively low across most of Thailand, though there is a noticeable increase compared to 2020, especially in provinces surrounding **Bangkok** and some southern regions.\n\n        -   While recovery is visible, the overall revenue is still below pre-pandemic levels, with the darker shades indicating moderate revenue growth in certain provinces.\n\n2.  **Local Gi (Right Maps)**:\n\n    -   **2020**:\n\n        -   **Blue clusters** dominate most of the map, indicating that **many provinces experienced low tourism revenue**, especially in northern and central Thailand.\n\n        -   **Red clusters** around Bangkok and southern provinces indicate that these regions were still maintaining higher levels of tourism revenue compared to neighboring provinces, forming **high-high clusters**.\n\n    -   **2022**:\n\n        -   **Blue clusters** are still prevalent across northern and northeastern Thailand, showing that these regions continue to struggle with low tourism revenue post-pandemic.\n\n        -   The **red clusters** (high-high clusters) are still present in central Thailand (Bangkok and surrounding provinces) and southern regions, indicating some resilience and recovery in tourism revenue compared to neighboring provinces.\n\n        -   **Orange regions** in the south suggest transitional zones where revenue is starting to improve but hasn't fully recovered yet.\n\n### Key Changes During and After COVID-19:\n\n1.  **Revenue Drop in 2020**:\n\n    -   The maps clearly show that most provinces experienced a **significant drop in tourism revenue** during COVID-19 in 2020, with very few provinces maintaining relatively high levels of revenue.\n\n    -   Provinces like **Bangkok, Phuket, and a few southern provinces** still managed to have some higher levels of tourism revenue, but they were isolated from neighboring provinces.\n\n2.  **Recovery in 2022**:\n\n    -   The maps show some **recovery in tourism revenue** in 2022, especially in the central and southern regions. However, northern and northeastern Thailand continue to struggle with low revenue, as seen in the continued presence of **Low-Low clusters**.\n\n    -   **High-High clusters** (red areas) have expanded in 2022, indicating that recovery is occurring in certain key tourism regions, especially around **Bangkok** and **Phuket**.\n\n3.  **Post-COVID Trends**:\n\n    -   The **high-high clusters** around **Bangkok** and **Phuket** regions, which were resilient during COVID-19, have strengthened in 2022.\n\n    -   While some regions have shown recovery, many provinces are still in the low-revenue category, indicating that tourism recovery has been uneven across Thailand, with certain regions recovering faster than others.\n\n### Conclusion:\n\n-   **2020 (During COVID-19)**: Significant decline in tourism revenue across Thailand, with only a few high-revenue provinces (Bangkok, Phuket, and surrounding regions).\n\n-   **2022 (Post-COVID-19)**: Signs of recovery in certain provinces, especially around Bangkok and southern Thailand. However, many provinces, particularly in the north and northeast, are still struggling with low tourism revenue.\n\nThe analysis shows that **tourism recovery has been concentrated in key regions** while other areas continue to face challenges in returning to pre-pandemic levels.\n",
    "supporting": [
      "Take-homeExercise2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}