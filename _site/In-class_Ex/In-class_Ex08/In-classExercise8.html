<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

  <meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

  <meta name="author" content="Tai Yu Ying">
  <meta name="dcterms.date" content="2024-09-21">

  <title>In-class Exercise 8 â€“ Mapping the Unseen</title>
  <style>
    code {
      white-space: pre-wrap;
    }

    span.smallcaps {
      font-variant: small-caps;
    }

    div.columns {
      display: flex;
      gap: min(4vw, 1.5em);
    }

    div.column {
      flex: auto;
      overflow-x: auto;
    }

    div.hanging-indent {
      margin-left: 1.5em;
      text-indent: -1.5em;
    }

    ul.task-list {
      list-style: none;
    }

    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em;
      /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */
      vertical-align: middle;
    }

    /* CSS for syntax highlighting */
    pre>code.sourceCode {
      white-space: pre;
      position: relative;
    }

    pre>code.sourceCode>span {
      line-height: 1.25;
    }

    pre>code.sourceCode>span:empty {
      height: 1.2em;
    }

    .sourceCode {
      overflow: visible;
    }

    code.sourceCode>span {
      color: inherit;
      text-decoration: inherit;
    }

    div.sourceCode {
      margin: 1em 0;
    }

    pre.sourceCode {
      margin: 0;
    }

    @media screen {
      div.sourceCode {
        overflow: auto;
      }
    }

    @media print {
      pre>code.sourceCode {
        white-space: pre-wrap;
      }

      pre>code.sourceCode>span {
        display: inline-block;
        text-indent: -5em;
        padding-left: 5em;
      }
    }

    pre.numberSource code {
      counter-reset: source-line 0;
    }

    pre.numberSource code>span {
      position: relative;
      left: -4em;
      counter-increment: source-line;
    }

    pre.numberSource code>span>a:first-child::before {
      content: counter(source-line);
      position: relative;
      left: -1em;
      text-align: right;
      vertical-align: baseline;
      border: none;
      display: inline-block;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      padding: 0 4px;
      width: 4em;
    }

    pre.numberSource {
      margin-left: 3em;
      padding-left: 4px;
    }

    div.sourceCode {}

    @media screen {
      pre>code.sourceCode>span>a:first-child::before {
        text-decoration: underline;
      }
    }
  </style>


  <script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../../site_libs/quarto-nav/headroom.min.js"></script>
  <script src="../../site_libs/clipboard/clipboard.min.js"></script>
  <script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="../../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../../site_libs/quarto-search/quarto-search.js"></script>
  <meta name="quarto:offset" content="../../">
  <script src="../../site_libs/quarto-html/quarto.js"></script>
  <script src="../../site_libs/quarto-html/popper.min.js"></script>
  <script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet"
    id="quarto-text-highlighting-styles">
  <script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
  <script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
  <style>
    html {
      scroll-behavior: smooth;
    }
  </style>


  <link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

  <div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
        <div class="navbar-brand-container mx-auto">
          <a class="navbar-brand" href="../../index.html">
            <span class="navbar-title">Mapping the Unseen</span>
          </a>
        </div>
        <div id="quarto-search" class="" title="Search"></div>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
          aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation"
          onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav navbar-nav-scroll me-auto">
            <li class="nav-item dropdown ">
              <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="link"
                data-bs-toggle="dropdown" aria-expanded="false">
                <span class="menu-text">Hands-on Exercises</span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-onExercise1.1.html">
                    <span class="dropdown-text">Hands-on Exercise 1.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-onExercise1.2.html">
                    <span class="dropdown-text">Hands-on Exercise 1.2</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-onExercise2.1.html">
                    <span class="dropdown-text">Hands-on Exercise 2.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-onExercise2.2.html">
                    <span class="dropdown-text">Hands-on Exercise 2.2</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-onExercise3.1.html">
                    <span class="dropdown-text">Hands-on Exercise 3.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-onExercise4.1.html">
                    <span class="dropdown-text">Hands-on Exercise 4.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-onExercise5.1.html">
                    <span class="dropdown-text">Hands-on Exercise 5.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-onExercise5.2.html">
                    <span class="dropdown-text">Hands-on Exercise 5.2</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-onExercise6.1.html">
                    <span class="dropdown-text">Hands-on Exercise 6.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-onExercise7.1.html">
                    <span class="dropdown-text">Hands-on Exercise 7.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-onExercise8.1.html">
                    <span class="dropdown-text">Hands-on Exercise 8.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-onExercise9.1.html">
                    <span class="dropdown-text">Hands-on Exercise 9.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-onExercise10.1.html">
                    <span class="dropdown-text">Hands-on Exercise 10.1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-onExercise10.2.html">
                    <span class="dropdown-text">Hands-on Exercise 10.2</span></a>
                </li>
              </ul>
            </li>
            <li class="nav-item dropdown ">
              <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="link"
                data-bs-toggle="dropdown" aria-expanded="false">
                <span class="menu-text">In-class Exercises</span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex01/In-classExercise1.html">
                    <span class="dropdown-text">In-class Exercise 1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-classExercise2.html">
                    <span class="dropdown-text">In-class Exercise 2</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-classExercise3.html">
                    <span class="dropdown-text">In-class Exercise 3</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-classExercise4.html">
                    <span class="dropdown-text">In-class Exercise 4</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-classExercise5.html">
                    <span class="dropdown-text">In-class Exercise 5</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-classExercise6.html">
                    <span class="dropdown-text">In-class Exercise 6</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex07/In-classExercise7.html">
                    <span class="dropdown-text">In-class Exercise 7</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex08/In-classExercise8.html">
                    <span class="dropdown-text">In-class Exercise 8</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-classExercise9.html">
                    <span class="dropdown-text">In-class Exercise 9</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex10/In-classExercise10.html">
                    <span class="dropdown-text">In-class Exercise 10</span></a>
                </li>
              </ul>
            </li>
            <li class="nav-item dropdown ">
              <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link"
                data-bs-toggle="dropdown" aria-expanded="false">
                <span class="menu-text">Take-home exercise</span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">
                <li>
                  <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-homeExercise1.html">
                    <span class="dropdown-text">Take-home Exercise 1</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-homeExercise2.html">
                    <span class="dropdown-text">Take-home Exercise 2</span></a>
                </li>
                <li>
                  <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-homeExercise3.html">
                    <span class="dropdown-text">Take-home Exercise 3</span></a>
                </li>
              </ul>
            </li>
          </ul>
          <ul class="navbar-nav navbar-nav-scroll ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="../../index.html">
                <span class="menu-text">Home</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../about.html">
                <span class="menu-text">About</span></a>
            </li>
          </ul>
        </div> <!-- /navcollapse -->
        <div class="quarto-navbar-tools">
        </div>
      </div> <!-- /container-fluid -->
    </nav>
  </header>
 <!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
  <!-- sidebar -->
  <!-- margin-sidebar -->
      <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
          <nav id="TOC" role="doc-toc" class="toc-active">
      <h2 id="toc-title">On this page</h2>
     
    <ul>
    <li><a href="#getting-started" id="toc-getting-started" class="nav-link active" data-scroll-target="#getting-started"><span class="header-section-number">1</span> Getting Started</a>
    <ul class="collapse">
    <li><a href="#installing-and-loading-r-packages" id="toc-installing-and-loading-r-packages" class="nav-link" data-scroll-target="#installing-and-loading-r-packages"><span class="header-section-number">1.1</span> Installing and Loading R packages</a></li>
    </ul></li>
    <li><a href="#preparing-data" id="toc-preparing-data" class="nav-link" data-scroll-target="#preparing-data"><span class="header-section-number">2</span> Preparing Data</a>
    <ul class="collapse">
    <li><a href="#data-import" id="toc-data-import" class="nav-link" data-scroll-target="#data-import"><span class="header-section-number">2.1</span> Data import</a></li>
    <li><a href="#data-sampling" id="toc-data-sampling" class="nav-link" data-scroll-target="#data-sampling"><span class="header-section-number">2.2</span> Data Sampling</a></li>
    <li><a href="#checking-of-overlapping-point" id="toc-checking-of-overlapping-point" class="nav-link" data-scroll-target="#checking-of-overlapping-point"><span class="header-section-number">2.3</span> Checking of overlapping point</a></li>
    <li><a href="#spatial-jitter" id="toc-spatial-jitter" class="nav-link" data-scroll-target="#spatial-jitter"><span class="header-section-number">2.4</span> Spatial jitter</a></li>
    </ul></li>
    <li><a href="#data-sampling-1" id="toc-data-sampling-1" class="nav-link" data-scroll-target="#data-sampling-1"><span class="header-section-number">3</span> Data Sampling</a></li>
    <li><a href="#multicollinearity-check" id="toc-multicollinearity-check" class="nav-link" data-scroll-target="#multicollinearity-check"><span class="header-section-number">4</span> Multicollinearity check</a></li>
    <li><a href="#building-a-non-spatial-multiple-linear-regression" id="toc-building-a-non-spatial-multiple-linear-regression" class="nav-link" data-scroll-target="#building-a-non-spatial-multiple-linear-regression"><span class="header-section-number">5</span> Building a non-spatial multiple linear regression</a></li>
    <li><a href="#multicollinearity-check-with-vif" id="toc-multicollinearity-check-with-vif" class="nav-link" data-scroll-target="#multicollinearity-check-with-vif"><span class="header-section-number">6</span> Multicollinearity check with VIF</a>
    <ul class="collapse">
    <li><a href="#vif" id="toc-vif" class="nav-link" data-scroll-target="#vif"><span class="header-section-number">6.1</span> VIF</a></li>
    <li><a href="#plotting-vif" id="toc-plotting-vif" class="nav-link" data-scroll-target="#plotting-vif"><span class="header-section-number">6.2</span> Plotting VIF</a></li>
    </ul></li>
    <li><a href="#predictive-modelling-with-gwr" id="toc-predictive-modelling-with-gwr" class="nav-link" data-scroll-target="#predictive-modelling-with-gwr"><span class="header-section-number">7</span> Predictive Modelling with gwr</a>
    <ul class="collapse">
    <li><a href="#computing-adaptive-bandwidth" id="toc-computing-adaptive-bandwidth" class="nav-link" data-scroll-target="#computing-adaptive-bandwidth"><span class="header-section-number">7.1</span> Computing adaptive bandwidth</a></li>
    </ul></li>
    <li><a href="#model-calibration" id="toc-model-calibration" class="nav-link" data-scroll-target="#model-calibration"><span class="header-section-number">8</span> Model calibration</a></li>
    <li><a href="#predictive-modelling-with-mlr" id="toc-predictive-modelling-with-mlr" class="nav-link" data-scroll-target="#predictive-modelling-with-mlr"><span class="header-section-number">9</span> Predictive Modelling with MLR</a>
    <ul class="collapse">
    <li><a href="#predicting-with-test-data" id="toc-predicting-with-test-data" class="nav-link" data-scroll-target="#predicting-with-test-data"><span class="header-section-number">9.1</span> Predicting with test data</a></li>
    </ul></li>
    <li><a href="#predictive-modelling-rf-method" id="toc-predictive-modelling-rf-method" class="nav-link" data-scroll-target="#predictive-modelling-rf-method"><span class="header-section-number">10</span> Predictive Modelling: RF method</a>
    <ul class="collapse">
    <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"><span class="header-section-number">10.1</span> Data preparation</a></li>
    <li><a href="#calibrating-rf-model" id="toc-calibrating-rf-model" class="nav-link" data-scroll-target="#calibrating-rf-model"><span class="header-section-number">10.2</span> Calibrating RF model</a></li>
    </ul></li>
    <li><a href="#predictive-modelling-spatialml-method" id="toc-predictive-modelling-spatialml-method" class="nav-link" data-scroll-target="#predictive-modelling-spatialml-method"><span class="header-section-number">11</span> Predictive Modelling: SpatialML method</a>
    <ul class="collapse">
    <li><a href="#calibrating-with-grf" id="toc-calibrating-with-grf" class="nav-link" data-scroll-target="#calibrating-with-grf"><span class="header-section-number">11.1</span> Calibrating with grf</a></li>
    </ul></li>
    <li><a href="#predicting-by-using-the-test-data" id="toc-predicting-by-using-the-test-data" class="nav-link" data-scroll-target="#predicting-by-using-the-test-data"><span class="header-section-number">12</span> Predicting by using the test data</a>
    <ul class="collapse">
    <li><a href="#preparing-the-test-data" id="toc-preparing-the-test-data" class="nav-link" data-scroll-target="#preparing-the-test-data"><span class="header-section-number">12.1</span> Preparing the test data</a></li>
    <li><a href="#predicting-with-the-test-data" id="toc-predicting-with-the-test-data" class="nav-link" data-scroll-target="#predicting-with-the-test-data"><span class="header-section-number">12.2</span> Predicting with the test data</a></li>
    <li><a href="#creating-df" id="toc-creating-df" class="nav-link" data-scroll-target="#creating-df"><span class="header-section-number">12.3</span> Creating DF</a></li>
    </ul></li>
    <li><a href="#visualising-the-predicted-values" id="toc-visualising-the-predicted-values" class="nav-link" data-scroll-target="#visualising-the-predicted-values"><span class="header-section-number">13</span> Visualising the predicted values</a>
    <ul class="collapse">
    <li><a href="#the-plot" id="toc-the-plot" class="nav-link" data-scroll-target="#the-plot"><span class="header-section-number">13.1</span> The plot</a></li>
    </ul></li>
    </ul>
  </nav>
      </div>
  <!-- main -->
  <main class="content column-page-left" id="quarto-document-content">
  
  <header id="title-block-header" class="quarto-title-block default">
  <div class="quarto-title">
  <h1 class="title">In-class Exercise 8</h1>
  </div>
  
  
  
  <div class="quarto-title-meta column-page-left">
  
      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tai Yu Ying </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 21, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">November 13, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  
  </header>
  
  
  <section id="getting-started" class="level2" data-number="1">
  <h2 data-number="1" class="anchored" data-anchor-id="getting-started"><span class="header-section-number">1</span> Getting Started</h2>
  <section id="installing-and-loading-r-packages" class="level3" data-number="1.1">
  <h3 data-number="1.1" class="anchored" data-anchor-id="installing-and-loading-r-packages"><span class="header-section-number">1.1</span> Installing and Loading R packages</h3>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spdep, GWmodel, SpatialML, </span>
  <span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               tmap, rsample, Metrics, tidyverse,</span>
  <span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               knitr, kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  </section>
  <section id="preparing-data" class="level2" data-number="2">
  <h2 data-number="2" class="anchored" data-anchor-id="preparing-data"><span class="header-section-number">2</span> Preparing Data</h2>
  <section id="data-import" class="level3" data-number="2.1">
  <h3 data-number="2.1" class="anchored" data-anchor-id="data-import"><span class="header-section-number">2.1</span> Data import</h3>
  <p>Reading the input data sets. It is in simple feature data frame.</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mdata <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"Data/mdata.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  <section id="data-sampling" class="level3" data-number="2.2">
  <h3 data-number="2.2" class="anchored" data-anchor-id="data-sampling"><span class="header-section-number">2.2</span> Data Sampling</h3>
  <p>Calibrating predictive models are computational intensive, especially random forest method is used. For quick prototyping, a 10% sample will be selected at random from the data by using the code chunk below.</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
  <span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>HDB_sample <span class="ot">&lt;-</span> mdata <span class="sc">%&gt;%</span></span>
  <span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">1500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  <section id="checking-of-overlapping-point" class="level3" data-number="2.3">
  <h3 data-number="2.3" class="anchored" data-anchor-id="checking-of-overlapping-point"><span class="header-section-number">2.3</span> Checking of overlapping point</h3>
  <div class="callout callout-style-default callout-warning callout-titled">
  <div class="callout-header d-flex align-content-center">
  <div class="callout-icon-container">
  <i class="callout-icon"></i>
  </div>
  <div class="callout-title-container flex-fill">
  Warning
  </div>
  </div>
  <div class="callout-body-container callout-body">
  <p>Note that there are five types of callouts, including: <code>note</code>, <code>warning</code>, <code>important</code>, <code>tip</code>, and <code>caution</code>.</p>
  </div>
  </div>
  <p>The code chunk below is used to check if there are overlapping point features.</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>overlapping_points <span class="ot">&lt;-</span> HDB_sample <span class="sc">%&gt;%</span></span>
  <span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">overlap =</span> <span class="fu">lengths</span>(<span class="fu">st_equals</span>(., .)) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  <section id="spatial-jitter" class="level3" data-number="2.4">
  <h3 data-number="2.4" class="anchored" data-anchor-id="spatial-jitter"><span class="header-section-number">2.4</span> Spatial jitter</h3>
  <p>In the code code chunk below,&nbsp;<a href="https://r-spatial.github.io/sf/reference/st_jitter.html"><code>st_jitter()</code></a>&nbsp;of&nbsp;<strong>sf</strong>&nbsp;package is used to move the point features by 10m to avoid overlapping point features.</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>HDB_sample <span class="ot">&lt;-</span> HDB_sample <span class="sc">%&gt;%</span></span>
  <span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_jitter</span>(<span class="at">amount =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  </section>
  <section id="data-sampling-1" class="level2" data-number="3">
  <h2 data-number="3" class="anchored" data-anchor-id="data-sampling-1"><span class="header-section-number">3</span> Data Sampling</h2>
  <p>The entire data are split into training and test data sets with 65% and 35% respectively by using&nbsp;<em>initial_split()</em>&nbsp;of&nbsp;<strong>rsample</strong>&nbsp;package. rsample is one of the package of tigymodels.</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
  <span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>resale_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(HDB_sample, </span>
  <span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">prop =</span> <span class="fl">6.67</span><span class="sc">/</span><span class="dv">10</span>,)</span>
  <span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(resale_split)</span>
  <span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(resale_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  <section id="multicollinearity-check" class="level2" data-number="4">
  <h2 data-number="4" class="anchored" data-anchor-id="multicollinearity-check"><span class="header-section-number">4</span> Multicollinearity check</h2>
  <p>In order to avoid multicollineariy. In the code chunk below,&nbsp;<a href="https://indrajeetpatil.github.io/ggstatsplot/articles/web_only/ggcorrmat.html"><code>ggcorrmat()</code></a>&nbsp;of&nbsp;<strong>ggstatsplot</strong>&nbsp;is used to plot a correlation matrix to check if there are pairs of highly correlated independent variables.</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mdata_nogeo <span class="ot">&lt;-</span> mdata <span class="sc">%&gt;%</span></span>
  <span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
  <span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>ggstatsplot<span class="sc">::</span><span class="fu">ggcorrmat</span>(mdata_nogeo[, <span class="dv">2</span><span class="sc">:</span><span class="dv">17</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output-display">
  <div>
  <figure class="figure">
  <p><img src="In-classExercise8_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
  </figure>
  </div>
  </div>
  </div>
  </section>
  <section id="building-a-non-spatial-multiple-linear-regression" class="level2" data-number="5">
  <h2 data-number="5" class="anchored" data-anchor-id="building-a-non-spatial-multiple-linear-regression"><span class="header-section-number">5</span> Building a non-spatial multiple linear regression</h2>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>price_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span></span>
  <span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                  storey_order <span class="sc">+</span> remaining_lease_mths <span class="sc">+</span></span>
  <span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                  PROX_CBD <span class="sc">+</span> PROX_ELDERLYCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
  <span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                  PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
  <span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                  PROX_SUPERMARKET <span class="sc">+</span> WITHIN_350M_KINDERGARTEN <span class="sc">+</span></span>
  <span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                  WITHIN_350M_CHILDCARE <span class="sc">+</span> WITHIN_350M_BUS <span class="sc">+</span></span>
  <span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                  WITHIN_1KM_PRISCH,</span>
  <span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>train_data)</span>
  <span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>olsrr<span class="sc">::</span><span class="fu">ols_regress</span>(price_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output cell-output-stdout">
  <pre><code>                              Model Summary                                
  --------------------------------------------------------------------------
  R                           0.862       RMSE                    60813.316 
  R-Squared                   0.742       MSE                3754578098.252 
  Adj. R-Squared              0.739       Coef. Var                  14.255 
  Pred R-Squared              0.734       AIC                     24901.005 
  MAE                     45987.256       SBC                     24979.529 
  --------------------------------------------------------------------------
   RMSE: Root Mean Square Error 
   MSE: Mean Square Error 
   MAE: Mean Absolute Error 
   AIC: Akaike Information Criteria 
   SBC: Schwarz Bayesian Criteria 
  
                                       ANOVA                                      
  -------------------------------------------------------------------------------
                      Sum of                                                     
                     Squares         DF         Mean Square       F         Sig. 
  -------------------------------------------------------------------------------
  Regression    1.065708e+13         14    761220078101.236    202.745    0.0000 
  Residual      3.698259e+12        985      3754578098.252                      
  Total         1.435534e+13        999                                          
  -------------------------------------------------------------------------------
  
                                                 Parameter Estimates                                                 
  ------------------------------------------------------------------------------------------------------------------
                     model          Beta    Std. Error    Std. Beta       t        Sig          lower         upper 
  ------------------------------------------------------------------------------------------------------------------
               (Intercept)    115703.696     34303.409                   3.373    0.001     48387.533    183019.860 
            floor_area_sqm      2778.618       292.262        0.165      9.507    0.000      2205.089      3352.146 
              storey_order     12698.165      1070.950        0.211     11.857    0.000     10596.559     14799.771 
      remaining_lease_mths       350.252        14.596        0.450     23.997    0.000       321.610       378.894 
                  PROX_CBD    -16225.588       630.092       -0.572    -25.751    0.000    -17462.065    -14989.110 
          PROX_ELDERLYCARE    -11330.930      3220.845       -0.061     -3.518    0.000    -17651.436     -5010.423 
               PROX_HAWKER    -19964.070      4021.046       -0.087     -4.965    0.000    -27854.872    -12073.268 
                  PROX_MRT    -39652.516      5412.288       -0.130     -7.326    0.000    -50273.456    -29031.577 
                 PROX_PARK    -15878.322      4609.199       -0.061     -3.445    0.001    -24923.300     -6833.344 
                 PROX_MALL    -15910.922      6438.111       -0.048     -2.471    0.014    -28544.911     -3276.933 
          PROX_SUPERMARKET    -18928.514     13304.965       -0.025     -1.423    0.155    -45037.848      7180.821 
  WITHIN_350M_KINDERGARTEN      9309.735      2024.293        0.079      4.599    0.000      5337.313     13282.157 
     WITHIN_350M_CHILDCARE     -1619.514      1180.948       -0.026     -1.371    0.171     -3936.977       697.948 
           WITHIN_350M_BUS      -447.695       738.715       -0.011     -0.606    0.545     -1897.331      1001.940 
         WITHIN_1KM_PRISCH    -10698.012      1543.511       -0.138     -6.931    0.000    -13726.960     -7669.065 
  ------------------------------------------------------------------------------------------------------------------</code></pre>
  </div>
  </div>
  </section>
  <section id="multicollinearity-check-with-vif" class="level2" data-number="6">
  <h2 data-number="6" class="anchored" data-anchor-id="multicollinearity-check-with-vif"><span class="header-section-number">6</span> Multicollinearity check with VIF</h2>
  <section id="vif" class="level3" data-number="6.1">
  <h3 data-number="6.1" class="anchored" data-anchor-id="vif"><span class="header-section-number">6.1</span> VIF</h3>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>vif <span class="ot">&lt;-</span> performance<span class="sc">::</span><span class="fu">check_collinearity</span>(price_mlr)</span>
  <span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(vif, </span>
  <span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Variance Inflation Factor (VIF) Results"</span>) <span class="sc">%&gt;%</span></span>
  <span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">18</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output-display">
  <table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
  <caption>Variance Inflation Factor (VIF) Results</caption>
  <thead>
  <tr class="header">
  <th style="text-align: left;" data-quarto-table-cell-role="th">Term</th>
  <th style="text-align: right;" data-quarto-table-cell-role="th">VIF</th>
  <th style="text-align: right;" data-quarto-table-cell-role="th">VIF_CI_low</th>
  <th style="text-align: right;" data-quarto-table-cell-role="th">VIF_CI_high</th>
  <th style="text-align: right;" data-quarto-table-cell-role="th">SE_factor</th>
  <th style="text-align: right;" data-quarto-table-cell-role="th">Tolerance</th>
  <th style="text-align: right;" data-quarto-table-cell-role="th">Tolerance_CI_low</th>
  <th style="text-align: right;" data-quarto-table-cell-role="th">Tolerance_CI_high</th>
  </tr>
  </thead>
  <tbody>
  <tr class="odd">
  <td style="text-align: left;">floor_area_sqm</td>
  <td style="text-align: right;">1.146686</td>
  <td style="text-align: right;">1.085743</td>
  <td style="text-align: right;">1.250945</td>
  <td style="text-align: right;">1.070834</td>
  <td style="text-align: right;">0.8720785</td>
  <td style="text-align: right;">0.7993954</td>
  <td style="text-align: right;">0.9210287</td>
  </tr>
  <tr class="even">
  <td style="text-align: left;">storey_order</td>
  <td style="text-align: right;">1.206020</td>
  <td style="text-align: right;">1.135720</td>
  <td style="text-align: right;">1.312734</td>
  <td style="text-align: right;">1.098189</td>
  <td style="text-align: right;">0.8291736</td>
  <td style="text-align: right;">0.7617690</td>
  <td style="text-align: right;">0.8804986</td>
  </tr>
  <tr class="odd">
  <td style="text-align: left;">remaining_lease_mths</td>
  <td style="text-align: right;">1.343645</td>
  <td style="text-align: right;">1.254833</td>
  <td style="text-align: right;">1.463410</td>
  <td style="text-align: right;">1.159157</td>
  <td style="text-align: right;">0.7442440</td>
  <td style="text-align: right;">0.6833358</td>
  <td style="text-align: right;">0.7969186</td>
  </tr>
  <tr class="even">
  <td style="text-align: left;">PROX_CBD</td>
  <td style="text-align: right;">1.887898</td>
  <td style="text-align: right;">1.733977</td>
  <td style="text-align: right;">2.074096</td>
  <td style="text-align: right;">1.374008</td>
  <td style="text-align: right;">0.5296898</td>
  <td style="text-align: right;">0.4821378</td>
  <td style="text-align: right;">0.5767088</td>
  </tr>
  <tr class="odd">
  <td style="text-align: left;">PROX_ELDERLYCARE</td>
  <td style="text-align: right;">1.140418</td>
  <td style="text-align: right;">1.080572</td>
  <td style="text-align: right;">1.244716</td>
  <td style="text-align: right;">1.067904</td>
  <td style="text-align: right;">0.8768712</td>
  <td style="text-align: right;">0.8033960</td>
  <td style="text-align: right;">0.9254357</td>
  </tr>
  <tr class="even">
  <td style="text-align: left;">PROX_HAWKER</td>
  <td style="text-align: right;">1.183865</td>
  <td style="text-align: right;">1.116887</td>
  <td style="text-align: right;">1.289223</td>
  <td style="text-align: right;">1.088056</td>
  <td style="text-align: right;">0.8446907</td>
  <td style="text-align: right;">0.7756609</td>
  <td style="text-align: right;">0.8953457</td>
  </tr>
  <tr class="odd">
  <td style="text-align: left;">PROX_MRT</td>
  <td style="text-align: right;">1.211390</td>
  <td style="text-align: right;">1.140307</td>
  <td style="text-align: right;">1.318485</td>
  <td style="text-align: right;">1.100632</td>
  <td style="text-align: right;">0.8254980</td>
  <td style="text-align: right;">0.7584464</td>
  <td style="text-align: right;">0.8769566</td>
  </tr>
  <tr class="even">
  <td style="text-align: left;">PROX_PARK</td>
  <td style="text-align: right;">1.186122</td>
  <td style="text-align: right;">1.118797</td>
  <td style="text-align: right;">1.291599</td>
  <td style="text-align: right;">1.089092</td>
  <td style="text-align: right;">0.8430839</td>
  <td style="text-align: right;">0.7742340</td>
  <td style="text-align: right;">0.8938169</td>
  </tr>
  <tr class="odd">
  <td style="text-align: left;">PROX_MALL</td>
  <td style="text-align: right;">1.435504</td>
  <td style="text-align: right;">1.335252</td>
  <td style="text-align: right;">1.565736</td>
  <td style="text-align: right;">1.198125</td>
  <td style="text-align: right;">0.6966193</td>
  <td style="text-align: right;">0.6386771</td>
  <td style="text-align: right;">0.7489224</td>
  </tr>
  <tr class="even">
  <td style="text-align: left;">PROX_SUPERMARKET</td>
  <td style="text-align: right;">1.226727</td>
  <td style="text-align: right;">1.153448</td>
  <td style="text-align: right;">1.335000</td>
  <td style="text-align: right;">1.107577</td>
  <td style="text-align: right;">0.8151773</td>
  <td style="text-align: right;">0.7490638</td>
  <td style="text-align: right;">0.8669656</td>
  </tr>
  <tr class="odd">
  <td style="text-align: left;">WITHIN_350M_KINDERGARTEN</td>
  <td style="text-align: right;">1.123989</td>
  <td style="text-align: right;">1.067172</td>
  <td style="text-align: right;">1.228865</td>
  <td style="text-align: right;">1.060183</td>
  <td style="text-align: right;">0.8896886</td>
  <td style="text-align: right;">0.8137594</td>
  <td style="text-align: right;">0.9370564</td>
  </tr>
  <tr class="even">
  <td style="text-align: left;">WITHIN_350M_CHILDCARE</td>
  <td style="text-align: right;">1.387119</td>
  <td style="text-align: right;">1.292841</td>
  <td style="text-align: right;">1.511748</td>
  <td style="text-align: right;">1.177760</td>
  <td style="text-align: right;">0.7209189</td>
  <td style="text-align: right;">0.6614860</td>
  <td style="text-align: right;">0.7734902</td>
  </tr>
  <tr class="odd">
  <td style="text-align: left;">WITHIN_350M_BUS</td>
  <td style="text-align: right;">1.193498</td>
  <td style="text-align: right;">1.125056</td>
  <td style="text-align: right;">1.299398</td>
  <td style="text-align: right;">1.092473</td>
  <td style="text-align: right;">0.8378731</td>
  <td style="text-align: right;">0.7695869</td>
  <td style="text-align: right;">0.8888447</td>
  </tr>
  <tr class="even">
  <td style="text-align: left;">WITHIN_1KM_PRISCH</td>
  <td style="text-align: right;">1.508943</td>
  <td style="text-align: right;">1.399770</td>
  <td style="text-align: right;">1.647930</td>
  <td style="text-align: right;">1.228390</td>
  <td style="text-align: right;">0.6627154</td>
  <td style="text-align: right;">0.6068219</td>
  <td style="text-align: right;">0.7144029</td>
  </tr>
  </tbody>
  </table>
  
  
  </div>
  </div>
  </section>
  <section id="plotting-vif" class="level3" data-number="6.2">
  <h3 data-number="6.2" class="anchored" data-anchor-id="plotting-vif"><span class="header-section-number">6.2</span> Plotting VIF</h3>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vif) <span class="sc">+</span></span>
  <span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output cell-output-stderr">
  <pre><code>Variable `Component` is not in your data frame :/</code></pre>
  </div>
  <div class="cell-output-display">
  <div>
  <figure class="figure">
  <p><img src="In-classExercise8_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
  </figure>
  </div>
  </div>
  </div>
  </section>
  </section>
  <section id="predictive-modelling-with-gwr" class="level2" data-number="7">
  <h2 data-number="7" class="anchored" data-anchor-id="predictive-modelling-with-gwr"><span class="header-section-number">7</span> Predictive Modelling with gwr</h2>
  <section id="computing-adaptive-bandwidth" class="level3" data-number="7.1">
  <h3 data-number="7.1" class="anchored" data-anchor-id="computing-adaptive-bandwidth"><span class="header-section-number">7.1</span> Computing adaptive bandwidth</h3>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span></span>
  <span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                  storey_order <span class="sc">+</span> remaining_lease_mths <span class="sc">+</span></span>
  <span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                  PROX_CBD <span class="sc">+</span> PROX_ELDERLYCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
  <span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                  PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
  <span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                  PROX_SUPERMARKET <span class="sc">+</span> WITHIN_350M_KINDERGARTEN <span class="sc">+</span></span>
  <span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                  WITHIN_350M_CHILDCARE <span class="sc">+</span> WITHIN_350M_BUS <span class="sc">+</span></span>
  <span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                  WITHIN_1KM_PRISCH,</span>
  <span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>train_data,</span>
  <span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">approach=</span><span class="st">"CV"</span>,</span>
  <span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel=</span><span class="st">"gaussian"</span>,</span>
  <span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
  <span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">longlat=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output cell-output-stdout">
  <pre><code>Adaptive bandwidth: 625 CV score: 3.459073e+12 
  Adaptive bandwidth: 394 CV score: 3.231785e+12 
  Adaptive bandwidth: 250 CV score: 2.914659e+12 
  Adaptive bandwidth: 162 CV score: 2.61087e+12 
  Adaptive bandwidth: 107 CV score: 2.240269e+12 
  Adaptive bandwidth: 73 CV score: 1.971725e+12 
  Adaptive bandwidth: 52 CV score: 1.796969e+12 
  Adaptive bandwidth: 39 CV score: 1.659294e+12 
  Adaptive bandwidth: 31 CV score: 1.574089e+12 
  Adaptive bandwidth: 26 CV score: 1.549859e+12 
  Adaptive bandwidth: 23 CV score: 1.542126e+12 
  Adaptive bandwidth: 21 CV score: 1.517495e+12 
  Adaptive bandwidth: 19 CV score: 1.515795e+12 
  Adaptive bandwidth: 19 CV score: 1.515795e+12 </code></pre>
  </div>
  </div>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output cell-output-stdout">
  <pre><code>[1] 19</code></pre>
  </div>
  </div>
  </section>
  </section>
  <section id="model-calibration" class="level2" data-number="8">
  <h2 data-number="8" class="anchored" data-anchor-id="model-calibration"><span class="header-section-number">8</span> Model calibration</h2>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span></span>
  <span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                            floor_area_sqm <span class="sc">+</span> storey_order <span class="sc">+</span></span>
  <span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                            remaining_lease_mths <span class="sc">+</span> PROX_CBD <span class="sc">+</span> </span>
  <span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                            PROX_ELDERLYCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
  <span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                            PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
  <span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                            PROX_SUPERMARKET <span class="sc">+</span> WITHIN_350M_KINDERGARTEN <span class="sc">+</span></span>
  <span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                            WITHIN_350M_CHILDCARE <span class="sc">+</span> WITHIN_350M_BUS <span class="sc">+</span></span>
  <span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                            WITHIN_1KM_PRISCH,</span>
  <span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data=</span>train_data,</span>
  <span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">bw=</span>bw_adaptive, </span>
  <span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
  <span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
  <span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output cell-output-stdout">
  <pre><code>   ***********************************************************************
     *                       Package   GWmodel                             *
     ***********************************************************************
     Program starts at: 2024-11-13 23:13:17.377869 
     Call:
     gwr.basic(formula = resale_price ~ floor_area_sqm + storey_order + 
      remaining_lease_mths + PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER + 
      PROX_MRT + PROX_PARK + PROX_MALL + PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN + 
      WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + WITHIN_1KM_PRISCH, 
      data = train_data, bw = bw_adaptive, kernel = "gaussian", 
      adaptive = TRUE, longlat = FALSE)
  
     Dependent (y) variable:  resale_price
     Independent variables:  floor_area_sqm storey_order remaining_lease_mths PROX_CBD PROX_ELDERLYCARE PROX_HAWKER PROX_MRT PROX_PARK PROX_MALL PROX_SUPERMARKET WITHIN_350M_KINDERGARTEN WITHIN_350M_CHILDCARE WITHIN_350M_BUS WITHIN_1KM_PRISCH
     Number of data points: 1000
     ***********************************************************************
     *                    Results of Global Regression                     *
     ***********************************************************************
  
     Call:
      lm(formula = formula, data = data)
  
     Residuals:
      Min      1Q  Median      3Q     Max 
  -167624  -37265    -415   34811  224601 
  
     Coefficients:
                              Estimate Std. Error t value Pr(&gt;|t|)    
     (Intercept)              115703.7    34303.4   3.373 0.000773 ***
     floor_area_sqm             2778.6      292.3   9.507  &lt; 2e-16 ***
     storey_order              12698.2     1071.0  11.857  &lt; 2e-16 ***
     remaining_lease_mths        350.2       14.6  23.997  &lt; 2e-16 ***
     PROX_CBD                 -16225.6      630.1 -25.751  &lt; 2e-16 ***
     PROX_ELDERLYCARE         -11330.9     3220.8  -3.518 0.000455 ***
     PROX_HAWKER              -19964.1     4021.1  -4.965 8.10e-07 ***
     PROX_MRT                 -39652.5     5412.3  -7.326 4.92e-13 ***
     PROX_PARK                -15878.3     4609.2  -3.445 0.000595 ***
     PROX_MALL                -15910.9     6438.1  -2.471 0.013628 *  
     PROX_SUPERMARKET         -18928.5    13305.0  -1.423 0.155150    
     WITHIN_350M_KINDERGARTEN   9309.7     2024.3   4.599 4.80e-06 ***
     WITHIN_350M_CHILDCARE     -1619.5     1181.0  -1.371 0.170572    
     WITHIN_350M_BUS            -447.7      738.7  -0.606 0.544624    
     WITHIN_1KM_PRISCH        -10698.0     1543.5  -6.931 7.55e-12 ***
  
     ---Significance stars
     Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
     Residual standard error: 61270 on 985 degrees of freedom
     Multiple R-squared: 0.7424
     Adjusted R-squared: 0.7387 
     F-statistic: 202.7 on 14 and 985 DF,  p-value: &lt; 2.2e-16 
     ***Extra Diagnostic information
     Residual sum of squares: 3.698259e+12
     Sigma(hat): 60874.22
     AIC:  24901.01
     AICc:  24901.56
     BIC:  24090.05
     ***********************************************************************
     *          Results of Geographically Weighted Regression              *
     ***********************************************************************
  
     *********************Model calibration information*********************
     Kernel function: gaussian 
     Adaptive bandwidth: 19 (number of nearest neighbours)
     Regression points: the same locations as observations are used.
     Distance metric: Euclidean distance metric is used.
  
     ****************Summary of GWR coefficient estimates:******************
                                     Min.     1st Qu.      Median     3rd Qu.
     Intercept                -1929556.87  -212598.86    17024.02   257847.89
     floor_area_sqm              -4876.14     1225.51     2018.78     3306.80
     storey_order                 3210.49     8119.31    10342.39    13862.24
     remaining_lease_mths         -580.58      342.55      422.24      502.46
     PROX_CBD                  -105593.30   -23346.95   -10607.05     -987.11
     PROX_ELDERLYCARE          -262648.75   -26074.82    -5822.21    18399.52
     PROX_HAWKER               -217431.78   -36646.93    -9877.60    21918.70
     PROX_MRT                  -306365.03   -92493.73   -56448.03   -20542.04
     PROX_PARK                 -256269.73   -33777.84   -16881.31     8222.49
     PROX_MALL                 -271665.05   -35764.73     6989.81    49201.57
     PROX_SUPERMARKET          -176016.67   -43172.22    -7557.30    30144.57
     WITHIN_350M_KINDERGARTEN   -43180.94    -9084.07    -2548.55     5547.48
     WITHIN_350M_CHILDCARE      -15164.34    -2227.68     1237.73     3471.33
     WITHIN_350M_BUS            -10853.13    -1800.71      515.95     2322.41
     WITHIN_1KM_PRISCH          -50557.86    -4197.56      328.93     4936.15
                                    Max.
     Intercept                1708870.77
     floor_area_sqm              7863.89
     storey_order               26828.90
     remaining_lease_mths         795.84
     PROX_CBD                  136969.60
     PROX_ELDERLYCARE          178558.00
     PROX_HAWKER               146699.32
     PROX_MRT                  123153.98
     PROX_PARK                  91605.63
     PROX_MALL                 340597.17
     PROX_SUPERMARKET          188218.61
     WITHIN_350M_KINDERGARTEN   40894.67
     WITHIN_350M_CHILDCARE      15700.66
     WITHIN_350M_BUS            11802.38
     WITHIN_1KM_PRISCH          32984.29
     ************************Diagnostic information*************************
     Number of data points: 1000 
     Effective number of parameters (2trace(S) - trace(S'S)): 419.1361 
     Effective degrees of freedom (n-2trace(S) + trace(S'S)): 580.8639 
     AICc (GWR book, Fotheringham, et al. 2002, p. 61, eq 2.33): 24103.2 
     AIC (GWR book, Fotheringham, et al. 2002,GWR p. 96, eq. 4.22): 23393.09 
     BIC (GWR book, Fotheringham, et al. 2002,GWR p. 61, eq. 2.34): 24423.86 
     Residual sum of squares: 599414392806 
     R-square value:  0.9582445 
     Adjusted R-square value:  0.9280629 
  
     ***********************************************************************
     Program stops at: 2024-11-13 23:13:17.744974 </code></pre>
  </div>
  </div>
  </section>
  <section id="predictive-modelling-with-mlr" class="level2" data-number="9">
  <h2 data-number="9" class="anchored" data-anchor-id="predictive-modelling-with-mlr"><span class="header-section-number">9</span> Predictive Modelling with MLR</h2>
  <section id="predicting-with-test-data" class="level3" data-number="9.1">
  <h3 data-number="9.1" class="anchored" data-anchor-id="predicting-with-test-data"><span class="header-section-number">9.1</span> Predicting with test data</h3>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>gwr_bw_test_adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span></span>
  <span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                  storey_order <span class="sc">+</span> remaining_lease_mths <span class="sc">+</span></span>
  <span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                  PROX_CBD <span class="sc">+</span> PROX_ELDERLYCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
  <span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                  PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
  <span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                  PROX_SUPERMARKET <span class="sc">+</span> WITHIN_350M_KINDERGARTEN <span class="sc">+</span></span>
  <span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                  WITHIN_350M_CHILDCARE <span class="sc">+</span> WITHIN_350M_BUS <span class="sc">+</span></span>
  <span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                  WITHIN_1KM_PRISCH,</span>
  <span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>test_data,</span>
  <span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">approach=</span><span class="st">"CV"</span>,</span>
  <span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel=</span><span class="st">"gaussian"</span>,</span>
  <span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
  <span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">longlat=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output cell-output-stdout">
  <pre><code>Adaptive bandwidth: 316 CV score: 1.75212e+12 
  Adaptive bandwidth: 203 CV score: 1.635819e+12 
  Adaptive bandwidth: 132 CV score: 1.45234e+12 
  Adaptive bandwidth: 89 CV score: 1.292145e+12 
  Adaptive bandwidth: 61 CV score: 1.115941e+12 
  Adaptive bandwidth: 45 CV score: 1.007808e+12 
  Adaptive bandwidth: 34 CV score: 886366215896 
  Adaptive bandwidth: 28 CV score: 859818490218 
  Adaptive bandwidth: 23 CV score: 8.5653e+11 
  Adaptive bandwidth: 21 CV score: 846230575802 
  Adaptive bandwidth: 19 CV score: 8.37295e+11 
  Adaptive bandwidth: 18 CV score: 833667778072 
  Adaptive bandwidth: 17 CV score: 834643831860 
  Adaptive bandwidth: 18 CV score: 833667778072 </code></pre>
  </div>
  </div>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>gwr_pred <span class="ot">&lt;-</span> <span class="fu">gwr.predict</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span></span>
  <span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                          floor_area_sqm <span class="sc">+</span> storey_order <span class="sc">+</span></span>
  <span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                          remaining_lease_mths <span class="sc">+</span> PROX_CBD <span class="sc">+</span> </span>
  <span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                          PROX_ELDERLYCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span> </span>
  <span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                          PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
  <span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                          PROX_SUPERMARKET <span class="sc">+</span> WITHIN_350M_KINDERGARTEN <span class="sc">+</span></span>
  <span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                          WITHIN_350M_CHILDCARE <span class="sc">+</span> WITHIN_350M_BUS <span class="sc">+</span> </span>
  <span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                          WITHIN_1KM_PRISCH, </span>
  <span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data=</span>train_data, </span>
  <span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">predictdata =</span> test_data, </span>
  <span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">bw=</span>bw_adaptive, </span>
  <span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
  <span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">adaptive=</span><span class="cn">TRUE</span>, </span>
  <span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  </section>
  <section id="predictive-modelling-rf-method" class="level2" data-number="10">
  <h2 data-number="10" class="anchored" data-anchor-id="predictive-modelling-rf-method"><span class="header-section-number">10</span> Predictive Modelling: RF method</h2>
  <section id="data-preparation" class="level3" data-number="10.1">
  <h3 data-number="10.1" class="anchored" data-anchor-id="data-preparation"><span class="header-section-number">10.1</span> Data preparation</h3>
  <p>Firstly, code chunk below is used to extract the coordinates of training and test data sets</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(HDB_sample)</span>
  <span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(train_data)</span>
  <span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>coords_test <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  <p>Next, code chunk below is used to drop the geometry column of both training and test data sets.</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>train_data_nogeom <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
  <span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  <section id="calibrating-rf-model" class="level3" data-number="10.2">
  <h3 data-number="10.2" class="anchored" data-anchor-id="calibrating-rf-model"><span class="header-section-number">10.2</span> Calibrating RF model</h3>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
  <span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span> storey_order <span class="sc">+</span> </span>
  <span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>               remaining_lease_mths <span class="sc">+</span> PROX_CBD <span class="sc">+</span> PROX_ELDERLYCARE <span class="sc">+</span> </span>
  <span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>               PROX_HAWKER <span class="sc">+</span> PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
  <span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>               PROX_SUPERMARKET <span class="sc">+</span> WITHIN_350M_KINDERGARTEN <span class="sc">+</span></span>
  <span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>               WITHIN_350M_CHILDCARE <span class="sc">+</span> WITHIN_350M_BUS <span class="sc">+</span> </span>
  <span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>               WITHIN_1KM_PRISCH,</span>
  <span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>train_data_nogeom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output cell-output-stdout">
  <pre><code>Ranger result
  
  Call:
   ranger(resale_price ~ floor_area_sqm + storey_order + remaining_lease_mths +      PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER + PROX_MRT + PROX_PARK +      PROX_MALL + PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +      WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + WITHIN_1KM_PRISCH,      data = train_data_nogeom) 
  
  Type:                             Regression 
  Number of trees:                  500 
  Sample size:                      1000 
  Number of independent variables:  14 
  Mtry:                             3 
  Target node size:                 5 
  Variable importance mode:         none 
  Splitrule:                        variance 
  OOB prediction error (MSE):       2289284270 
  R squared (OOB):                  0.8406868 </code></pre>
  </div>
  </div>
  </section>
  </section>
  <section id="predictive-modelling-spatialml-method" class="level2" data-number="11">
  <h2 data-number="11" class="anchored" data-anchor-id="predictive-modelling-spatialml-method"><span class="header-section-number">11</span> Predictive Modelling: SpatialML method</h2>
  <section id="calibrating-with-grf" class="level3" data-number="11.1">
  <h3 data-number="11.1" class="anchored" data-anchor-id="calibrating-with-grf"><span class="header-section-number">11.1</span> Calibrating with grf</h3>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
  <span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">grf</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span> </span>
  <span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                       storey_order <span class="sc">+</span> remaining_lease_mths <span class="sc">+</span> </span>
  <span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                       PROX_CBD <span class="sc">+</span> PROX_ELDERLYCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span> </span>
  <span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                       PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
  <span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                       PROX_SUPERMARKET <span class="sc">+</span> WITHIN_350M_KINDERGARTEN <span class="sc">+</span></span>
  <span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                       WITHIN_350M_CHILDCARE <span class="sc">+</span> WITHIN_350M_BUS <span class="sc">+</span></span>
  <span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                       WITHIN_1KM_PRISCH,</span>
  <span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dframe=</span>train_data_nogeom, </span>
  <span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bw=</span><span class="dv">55</span>,</span>
  <span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">kernel=</span><span class="st">"adaptive"</span>,</span>
  <span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">coords=</span>coords_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  Number of Observations: 1000</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>Number of Independent Variables: 14</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>Kernel: Adaptive
  Neightbours: 55</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  --------------- Global ML Model Summary ---------------</code></pre>
  </div>
  <div class="cell-output cell-output-stdout">
  <pre><code>Ranger result
  
  Call:
   ranger(resale_price ~ floor_area_sqm + storey_order + remaining_lease_mths +      PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER + PROX_MRT + PROX_PARK +      PROX_MALL + PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +      WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + WITHIN_1KM_PRISCH,      data = train_data_nogeom, num.trees = 500, mtry = 4, importance = "impurity",      num.threads = NULL) 
  
  Type:                             Regression 
  Number of trees:                  500 
  Sample size:                      1000 
  Number of independent variables:  14 
  Mtry:                             4 
  Target node size:                 5 
  Variable importance mode:         impurity 
  Splitrule:                        variance 
  OOB prediction error (MSE):       2056587170 
  R squared (OOB):                  0.8568804 </code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  Importance:</code></pre>
  </div>
  <div class="cell-output cell-output-stdout">
  <pre><code>          floor_area_sqm             storey_order     remaining_lease_mths 
              6.932661e+11             1.471090e+12             2.512971e+12 
                  PROX_CBD         PROX_ELDERLYCARE              PROX_HAWKER 
              4.695331e+12             5.430899e+11             6.061641e+11 
                  PROX_MRT                PROX_PARK                PROX_MALL 
              8.355142e+11             5.612980e+11             4.449032e+11 
          PROX_SUPERMARKET WITHIN_350M_KINDERGARTEN    WITHIN_350M_CHILDCARE 
              3.698543e+11             1.287529e+11             2.290324e+11 
           WITHIN_350M_BUS        WITHIN_1KM_PRISCH 
              2.310307e+11             7.644464e+11 </code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  Mean Square Error (Not OOB): 398120142.153</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>R-squared (Not OOB) %: 97.227</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>AIC (Not OOB): 19832.264</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>AICc (Not OOB): 19832.752</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  --------------- Local Model Summary ---------------</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  Residuals OOB:</code></pre>
  </div>
  <div class="cell-output cell-output-stdout">
  <pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
  -184085.0  -20795.2    -516.8     178.7   20671.5  274779.4 </code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  Residuals Predicted (Not OOB):</code></pre>
  </div>
  <div class="cell-output cell-output-stdout">
  <pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
  -37820.08  -3281.33   -172.36    -54.36   2748.41  42911.98 </code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  Local Variable Importance:</code></pre>
  </div>
  <div class="cell-output cell-output-stdout">
  <pre><code>                                Min          Max         Mean          StD
  floor_area_sqm            702566076 192039435622  24439851301  32315186396
  storey_order              524394197 326852101138  27886370072  50933020940
  remaining_lease_mths     2464216417 611445808237 100359710505 136911116094
  PROX_CBD                  953355726 341984306131  30919410973  48930401701
  PROX_ELDERLYCARE         1787597000 156688052046  23288662477  25527677284
  PROX_HAWKER               975275115 215455731090  20704450633  24350593361
  PROX_MRT                 1153720107 273822803356  28938031100  46467338542
  PROX_PARK                1092427392 177770405840  20001457798  21381702325
  PROX_MALL                1449808082 264760757366  27267356139  40409820558
  PROX_SUPERMARKET         1062704743 180557169033  18943346815  26992731082
  WITHIN_350M_KINDERGARTEN  195255712  53600246951   5750331988   7379146411
  WITHIN_350M_CHILDCARE     428249413 181612526642  18538757258  33845887945
  WITHIN_350M_BUS           551146872 145921801482   9046578689  11374420454
  WITHIN_1KM_PRISCH         250420217  64953249485   6414575294   7430579082</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  Mean squared error (OOB): 2039687899.864</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>R-squared (OOB) %: 85.791</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>AIC (OOB): 21466.063</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>AICc (OOB): 21466.55</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>Mean squared error Predicted (Not OOB): 50894238.642</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>R-squared Predicted (Not OOB) %: 99.645</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>AIC Predicted (Not OOB): 17775.26</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>AICc Predicted (Not OOB): 17775.748</code></pre>
  </div>
  <div class="cell-output cell-output-stderr">
  <pre><code>
  Calculation time (in seconds): 22.7843</code></pre>
  </div>
  </div>
  </section>
  </section>
  <section id="predicting-by-using-the-test-data" class="level2" data-number="12">
  <h2 data-number="12" class="anchored" data-anchor-id="predicting-by-using-the-test-data"><span class="header-section-number">12</span> Predicting by using the test data</h2>
  <section id="preparing-the-test-data" class="level3" data-number="12.1">
  <h3 data-number="12.1" class="anchored" data-anchor-id="preparing-the-test-data"><span class="header-section-number">12.1</span> Preparing the test data</h3>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>test_data_nogeom <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
  <span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  test_data, coords_test) <span class="sc">%&gt;%</span></span>
  <span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  <section id="predicting-with-the-test-data" class="level3" data-number="12.2">
  <h3 data-number="12.2" class="anchored" data-anchor-id="predicting-with-the-test-data"><span class="header-section-number">12.2</span> Predicting with the test data</h3>
  <p>In the code chunk below,&nbsp;<code>predict.grf()</code>&nbsp;of&nbsp;<strong>spatialML</strong>&nbsp;for predicting re-sale prices in the&nbsp;<strong>test data</strong>&nbsp;set (i.e.&nbsp;<em>test_data_nogeom</em>)</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>gwRF_pred <span class="ot">&lt;-</span> <span class="fu">predict.grf</span>(gwRF_adaptive, </span>
  <span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                           test_data_nogeom, </span>
  <span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x.var.name=</span><span class="st">"X"</span>,</span>
  <span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y.var.name=</span><span class="st">"Y"</span>, </span>
  <span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">local.w=</span><span class="dv">1</span>,</span>
  <span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">global.w=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  <section id="creating-df" class="level3" data-number="12.3">
  <h3 data-number="12.3" class="anchored" data-anchor-id="creating-df"><span class="header-section-number">12.3</span> Creating DF</h3>
  <p>Next, the code chunk below is used to convert the output from&nbsp;<code>predict.grf()</code>&nbsp;into a data.frame.</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>GRF_pred_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(gwRF_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  <p>Then,&nbsp;<code>cbind()</code>&nbsp;is used to append fields in GRF_pred_df data.frame onto test_data.</p>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>test_data_pred <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, </span>
  <span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                        GRF_pred_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  </div>
  </section>
  </section>
  <section id="visualising-the-predicted-values" class="level2" data-number="13">
  <h2 data-number="13" class="anchored" data-anchor-id="visualising-the-predicted-values"><span class="header-section-number">13</span> Visualising the predicted values</h2>
  <section id="the-plot" class="level3" data-number="13.1">
  <h3 data-number="13.1" class="anchored" data-anchor-id="the-plot"><span class="header-section-number">13.1</span> The plot</h3>
  <div class="cell">
  <div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> test_data_pred,</span>
  <span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> gwRF_pred,</span>
  <span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> resale_price)) <span class="sc">+</span></span>
  <span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
  <div class="cell-output-display">
  <div>
  <figure class="figure">
  <p><img src="In-classExercise8_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
  </figure>
  </div>
  </div>
  </div>
  
  
  </section>
  </section>
  
  </main> <!-- /main -->
  <script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    toggleBodyColorPrimary();  
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      // For code content inside modals, clipBoardJS needs to be initialized with a container option
      // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        // TODO in 1.5, we should make sure this works without a callout special case
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
  </div> <!-- /content -->
  
  
  
  
  <script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
  </body></html>